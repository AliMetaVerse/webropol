<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Meter Example</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/50ef2d3cf8.js" crossorigin="anonymous"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Tailwind config with Webropol tokens -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'webropol-primary': { 50: '#f0fdff', 500: '#06b6d4', 700: '#0e7490', 900: '#164e63' },
                        'webropol-gray': { 50: '#f8fafc', 500: '#64748b', 900: '#0f172a' }
                    },
                    fontFamily: { 'sans': ['Inter', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Design system components -->
    <script src="../design-system/components/navigation/Sidebar.js" type="module"></script>
    <script src="../design-system/components/navigation/Header.js" type="module"></script>
    <script src="../design-system/components/navigation/Breadcrumbs.js" type="module"></script>
</head>
<body x-data="moduleApp()" @toggle-fullscreen.window="fullscreen = $event.detail">
    <div class="flex h-screen bg-webropol-gray-50">
        <webropol-sidebar active="examples" base="../" x-show="!fullscreen" class="transition-all duration-300"></webropol-sidebar>
        
        <div class="flex-1 flex flex-col overflow-hidden">
            <webropol-header username="User" show-notifications show-help show-user-menu show-theme-selector 
                             x-show="!fullscreen" class="transition-all duration-300"></webropol-header>
            
            <div class="bg-white/70 backdrop-blur px-0 sm:px-4 transition-all duration-300"
                 x-show="!fullscreen">
                <webropol-breadcrumbs trail='[{"label":"Home","url":"../index.html"},{"label":"Examples","url":"#"}, {"label":"Health Meter","url":"#"}]'></webropol-breadcrumbs>
            </div>
            
            <main class="flex-1 overflow-y-auto px-4 py-6 md:px-6 md:py-12" role="main">
                
                <!-- Use 'x-cloak' to avoid flicker but we removed it per instructions unless styled. 
                     We will manage state via Alpine. -->
                
                <!-- Health Meter App Container -->
                <div class="max-w-6xl mx-auto" x-data="healthSlider()">

                    <!-- Top Bar: Mode Switcher & Settings -->
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                        <!-- Mode Tabs -->
                        <div class="bg-webropol-gray-100 p-1 rounded-lg inline-flex">
                            <button @click="mode = 'edit'; value = null; $dispatch('toggle-fullscreen', false)" 
                                    :class="mode === 'edit' ? 'bg-white shadow-sm text-webropol-primary-700 font-semibold' : 'text-webropol-gray-500 hover:text-webropol-gray-700'"
                                    class="px-4 py-2 rounded-md text-sm transition-all duration-200">
                                <i class="fa-light fa-pen-to-square mr-2"></i>Edit
                            </button>
                            <button @click="mode = 'respond'; $dispatch('toggle-fullscreen', true)" 
                                    :class="mode === 'respond' ? 'bg-white shadow-sm text-webropol-primary-700 font-semibold' : 'text-webropol-gray-500 hover:text-webropol-gray-700'"
                                    class="px-4 py-2 rounded-md text-sm transition-all duration-200">
                                <i class="fa-light fa-eye mr-2"></i>Respond
                            </button>
                        </div>

                        <!-- Settings Button -->
                        <!-- Removed duplicate settings button from header -->
                    </div>

                    <!-- Main Card -->
                    <div class="question-card transition-all duration-300 relative" 
                         :class="mode === 'edit' ? 'selected' : 'bg-white rounded-3xl shadow-xl hover:shadow-2xl border border-transparent'">
                        
                        <!-- Header Section (Toolbar) - Only in Edit Mode -->
                        <div class="question-card-header" x-show="mode === 'edit'">
                            <!-- Left: Type Badge -->
                            <div class="bg-[#FFF8DD] text-gray-800 px-4 py-2 rounded-lg flex items-center gap-3 text-sm font-semibold shadow-sm">
                                <i class="fa-light fa-sliders text-lg"></i>
                                <span>Numeric slider</span>
                            </div>

                            <!-- Right: Actions -->
                            <div class="flex items-center gap-1">
                                <button class="w-10 h-10 flex items-center justify-center text-gray-500 hover:text-webropol-primary-600 rounded-full hover:bg-gray-100 transition-colors" title="Mandatory">
                                    <i class="fa-light fa-asterisk text-lg"></i>
                                </button>
                                <button class="w-10 h-10 flex items-center justify-center text-gray-500 hover:text-webropol-primary-600 rounded-full hover:bg-gray-100 transition-colors" title="Randomize">
                                    <i class="fa-light fa-shuffle text-lg"></i>
                                </button>
                                <button class="w-10 h-10 flex items-center justify-center text-gray-500 hover:text-webropol-primary-600 rounded-full hover:bg-gray-100 transition-colors" title="Add media">
                                    <div class="relative">
                                        <i class="fa-light fa-image text-lg"></i>
                                        <i class="fa-solid fa-plus absolute -top-1 -right-1 text-[10px] bg-white rounded-full"></i>
                                    </div>
                                </button>
                                <button @click="showSettings = true" class="w-10 h-10 flex items-center justify-center text-gray-500 hover:text-webropol-primary-600 rounded-full hover:bg-gray-100 transition-colors" title="Settings">
                                    <i class="fa-light fa-gear text-lg"></i>
                                </button>
                                <button class="w-10 h-10 flex items-center justify-center text-gray-500 hover:text-webropol-primary-600 rounded-full hover:bg-gray-100 transition-colors" title="Copy">
                                    <i class="fa-light fa-copy text-lg"></i>
                                </button>
                                <div class="w-px h-6 bg-gray-300 mx-2"></div>
                                <button class="w-10 h-10 flex items-center justify-center text-gray-500 hover:text-red-600 bg-gray-100/80 hover:bg-red-50 rounded-lg transition-colors" title="Delete">
                                    <i class="fa-light fa-trash-can text-lg"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Card Body -->
                        <div class="p-6 md:p-12">
                            <!-- Title Section -->
                            <div class="mb-10 pl-2">
                                <!-- Edit Mode: Inputs -->
                                <template x-if="mode === 'edit'">
                                    <div class="space-y-4">
                                        <input type="text" x-model="texts.title" class="w-full text-2xl md:text-4xl font-extrabold text-webropol-gray-900 tracking-tight border-b-2 border-transparent hover:border-webropol-primary-100 focus:border-webropol-primary-500 focus:outline-none transition-all duration-200 bg-transparent placeholder-webropol-gray-300 pb-2">
                                    </div>
                                </template>
                                <!-- Respond Mode: Text -->
                                <template x-if="mode === 'respond'">
                                    <div class="space-y-2">
                                        <h1 class="text-2xl md:text-4xl font-extrabold text-webropol-gray-900 tracking-tight leading-tight" x-text="texts.title"></h1>
                                    </div>
                                </template>
                            </div>

                            <!-- Content Area (Flex determines layout) -->
                            <div class="flex gap-8 md:gap-16 transition-all duration-500"
                                 :class="orientation === 'vertical' ? 'flex-col md:flex-row' : 'flex-col'">
                            
                                <!-- Instructions & Display Box -->
                                <div class="flex-1 pt-4 flex transition-all duration-500"
                                     :class="orientation === 'vertical' ? 'flex-col' : 'flex-col md:flex-row justify-between items-start gap-8 md:gap-12'">
                                
                                <!-- Instructions List -->
                                <div class="prose prose-base md:prose-lg text-webropol-gray-600 max-w-none transition-opacity duration-300"
                                     :class="orientation === 'horizontal' ? 'flex-1' : ''">
                                    
                                    <!-- Edit Mode: Simple WYSIWYG Editor -->
                                    <div x-show="mode === 'edit'" class="w-full relative group">
                                        <div class="border-2 border-transparent hover:border-webropol-primary-200 focus-within:border-webropol-primary-500 rounded-xl bg-gray-50/50 transition-all duration-200 shadow-inner overflow-hidden flex flex-col min-h-[300px]">
                                            <!-- Simple Toolbar -->
                                            <div class="flex items-center gap-1 p-2 border-b border-gray-200 bg-gray-100/50 sticky top-0 z-10">
                                                <button @click="document.execCommand('bold');" 
                                                        class="p-2 text-webropol-gray-500 hover:text-webropol-primary-600 hover:bg-white rounded transition-colors" title="Bold">
                                                    <i class="fa-regular fa-bold"></i>
                                                </button>
                                                <button @click="document.execCommand('italic');" 
                                                        class="p-2 text-webropol-gray-500 hover:text-webropol-primary-600 hover:bg-white rounded transition-colors" title="Italic">
                                                    <i class="fa-regular fa-italic"></i>
                                                </button>
                                                <div class="w-px h-4 bg-gray-300 mx-1"></div>
                                                <button @click="document.execCommand('insertUnorderedList');" 
                                                        class="p-2 text-webropol-gray-500 hover:text-webropol-primary-600 hover:bg-white rounded transition-colors" title="Bullet List">
                                                    <i class="fa-regular fa-list-ul"></i>
                                                </button>
                                                <button @click="document.execCommand('insertOrderedList');" 
                                                        class="p-2 text-webropol-gray-500 hover:text-webropol-primary-600 hover:bg-white rounded transition-colors" title="Numbered List">
                                                    <i class="fa-regular fa-list-ol"></i>
                                                </button>
                                            </div>
                                            <!-- Editable Area -->
                                            <div contenteditable="true" 
                                                 class="flex-1 p-6 focus:outline-none leading-loose text-webropol-gray-700 editor-content [&_ul]:list-disc [&_ul]:pl-5 [&_ol]:list-decimal [&_ol]:pl-5 [&_li]:mb-1"
                                                 @input="texts.instructions = $el.innerHTML"
                                                 x-init="$el.innerHTML = texts.instructions"
                                                 >
                                            </div>
                                        </div>
                                        <div class="absolute top-14 right-4 text-xs font-semibold text-webropol-primary-400 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none uppercase tracking-wide">Editable Text</div>
                                    </div>

                                    <!-- Respond Mode: HTML Content -->
                                    <div x-show="mode === 'respond'" 
                                         class="text-webropol-gray-700 leading-relaxed font-medium 
                                                [&_ul]:list-disc [&_ul]:pl-5 [&_ul]:space-y-1
                                                [&_ol]:list-decimal [&_ol]:pl-5 [&_ol]:space-y-1
                                                [&_li]:mb-1
                                                [&_b]:font-bold [&_i]:italic"
                                         x-html="texts.instructions">
                                    </div>
                                </div>

                                <!-- "Your Health" Black Box Display -->
                                <div class="bg-[#1a0b2e] border-2 border-[#4c1d95] text-white flex flex-col items-center justify-center shadow-2xl transition-all duration-500 flex-shrink-0 relative overflow-hidden group rounded-xl"
                                     :class="orientation === 'vertical' ? 'mt-8 md:mt-12 w-full max-w-[14rem] md:w-56 h-72 mx-auto md:mx-0' : 'mt-8 md:mt-0 w-full max-w-[16rem] md:w-64 h-56 py-8 mx-auto md:mx-0'">
                                    
                                    <!-- Subtle gradient overlay for depth without losing pure black feel -->
                                    <div class="absolute inset-0 bg-gradient-to-br from-[#7c3aed]/20 to-transparent pointer-events-none"></div>

                                    <template x-if="mode === 'edit'">
                                        <div class="flex flex-col items-center text-center relative z-10">
                                            <input x-model="texts.boxLabel1" class="bg-transparent text-center text-white/90 text-sm font-bold tracking-[0.25em] mb-2 w-36 border-b border-transparent hover:border-white/40 focus:border-white focus:outline-none transition-all uppercase placeholder-white/30">
                                            <input x-model="texts.boxLabel2" class="bg-transparent text-center text-white/90 text-sm font-bold tracking-[0.25em] mb-2 w-36 border-b border-transparent hover:border-white/40 focus:border-white focus:outline-none transition-all uppercase placeholder-white/30">
                                            <input x-model="texts.boxLabel3" class="bg-transparent text-center text-white/90 text-sm font-bold tracking-[0.25em] mb-6 w-36 border-b border-transparent hover:border-white/40 focus:border-white focus:outline-none transition-all uppercase placeholder-white/30">
                                        </div>
                                    </template>
                                    <template x-if="mode === 'respond'">
                                        <div class="flex flex-col items-center text-center relative z-10 transition-transform duration-300 group-hover:-translate-y-1">
                                            <span class="text-xs font-bold tracking-[0.3em] mb-2 text-white/90 uppercase" x-text="texts.boxLabel1"></span>
                                            <span class="text-xs font-bold tracking-[0.3em] mb-2 text-white/90 uppercase" x-text="texts.boxLabel2"></span>
                                            <span class="text-xs font-bold tracking-[0.3em] text-white/90 uppercase" :class="orientation === 'vertical' ? 'mb-12' : 'mb-6'" x-text="texts.boxLabel3"></span>
                                        </div>
                                    </template>

                                    <!-- Number Input / Display -->
                                    <div class="relative z-10 w-full px-4">
                                        <input type="number" 
                                               x-model="value"
                                               readonly
                                               placeholder="&mdash;"
                                               @input="if($el.value > 100) value = 100; if($el.value < 0) value = 0;"
                                               class="bg-transparent text-white font-bold tabular-nums leading-none tracking-tighter text-center w-full focus:outline-none border-b-2 border-transparent transition-all duration-200 p-0 shadow-none ring-0 appearance-none font-inter placeholder-white/20"
                                               :class="[
                                                    orientation === 'vertical' ? 'text-5xl md:text-7xl' : 'text-5xl md:text-7xl',
                                                    mode === 'respond' ? 'hover:text-white focus:border-webropol-primary-400 cursor-text' : 'pointer-events-none'
                                               ]">
                                    </div>
                                </div>
                            </div>

                            <!-- Scale Section -->
                            <div class="flex-shrink-0 select-none transition-all duration-500 ease-in-out"
                                 :class="orientation === 'vertical' ? 'w-full md:w-80 pt-2' : 'w-full mt-8 md:mt-12'">
                                
                                <!-- Vertical Layout -->
                                <template x-if="orientation === 'vertical'">
                                    <div>
                                        <!-- Top Label (Best) -->
                                        <div class="flex items-center justify-start gap-4 mb-8 pl-2 group">
                                            <div class="flex flex-col items-start text-webropol-primary-700 font-bold text-xs tracking-widest uppercase leading-tight">
                                                <template x-if="mode === 'edit'">
                                                    <div class="flex flex-col items-start gap-1">
                                                        <input x-model="texts.bestLabel1" class="text-left bg-transparent border-b border-transparent hover:border-webropol-primary-200 focus:outline-none w-24">
                                                        <input x-model="texts.bestLabel2" class="text-left bg-transparent border-b border-transparent hover:border-webropol-primary-200 focus:outline-none w-24">
                                                        <input x-model="texts.bestLabel3" class="text-left bg-transparent border-b border-transparent hover:border-webropol-primary-200 focus:outline-none w-24">
                                                    </div>
                                                </template>
                                                <template x-if="mode === 'respond'">
                                                    <div class="flex flex-col items-start">
                                                        <span x-text="texts.bestLabel1"></span>
                                                        <span x-text="texts.bestLabel2"></span>
                                                        <span x-text="texts.bestLabel3"></span>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                        
                                        <!-- Vertical Track -->
                                        <div class="relative h-[400px] sm:h-[600px] w-full" 
                                             :class="{'pointer-events-none': mode === 'edit'}"
                                             @mousedown="startDrag"
                                             @touchstart.prevent="startDrag"
                                             x-ref="trackVertical">
                                            
                                            <!-- Interaction Hint -->
                                            <div x-show="value === null" 
                                                 class="absolute left-28 top-1/2 -translate-y-1/2 pointer-events-none transition-opacity duration-500 hidden sm:block"
                                                 x-transition:leave="duration-500">
                                                <div class="text-webropol-gray-400 font-bold tracking-[0.25em] text-xs uppercase opacity-70 animate-pulse" 
                                                     style="writing-mode: vertical-rl; transform: rotate(180deg);">
                                                    Tap scale to select value
                                                </div>
                                            </div>

                                            <!-- Ticks -->
                                            <template x-for="i in 101">
                                                <div class="absolute left-0 w-full flex items-center justify-start pointer-events-none"
                                                     :style="`top: ${100 - (i-1)}%; transform: translateY(-50%);`">
                                                    <div class="h-px bg-gray-400" :class="(i-1) % 10 === 0 ? 'w-8 bg-gray-500' : 'w-4'"></div>
                                                    <span x-show="(i-1) % 10 === 0" class="ml-4 text-webropol-gray-500 font-medium text-lg w-8 text-left tabular-nums select-none" x-text="i-1"></span>
                                                </div>
                                            </template>

                                            <!-- Click Area -->
                                            <div class="absolute inset-y-0 left-0 w-32 cursor-pointer z-10"
                                                 @mousemove="onDrag" @touchmove.prevent="onDrag" @mouseup.window="stopDrag" @touchend.window="stopDrag" @click="updateValue"></div>

                                            <!-- Vertical Indicators -->
                                            <div x-show="value !== null" class="absolute w-full pointer-events-none transition-all duration-75 ease-out z-20"
                                                 :style="`top: ${100 - (value ?? 50)}%; transform: translateY(-50%);`">
                                                <div class="absolute left-4 top-1/2 -translate-y-1/2 w-48 border-t-2 border-webropol-gray-400 border-dotted"></div>
                                                <div class="absolute left-[190px] top-1/2 -translate-y-1/2 text-5xl text-[#5c7ae0] font-medium pl-1 flex items-center gap-1">
                                                    <div class="w-0 h-0 border-t-[8px] border-t-transparent border-b-[8px] border-b-transparent border-r-[14px] border-r-[#5c7ae0]"></div>
                                                    <span x-text="Math.round(value)"></span>
                                                </div>
                                                <div class="absolute left-[4px] top-1/2 -translate-y-1/2 w-6 h-6 bg-[#ee4036] rounded-full shadow-[0_4px_6px_rgba(0,0,0,0.3)] z-30 ring-2 ring-white scale-125 transition-transform hover:scale-150"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Bottom Label (Worst) -->
                                        <div class="flex items-center justify-start gap-4 mt-8 pl-2 group">
                                            <div class="flex flex-col items-start text-webropol-gray-500 font-bold text-xs tracking-widest uppercase leading-tight">
                                                <template x-if="mode === 'edit'">
                                                    <div class="flex flex-col items-start gap-1">
                                                        <input x-model="texts.worstLabel1" class="text-left bg-transparent border-b border-transparent hover:border-webropol-gray-300 focus:outline-none w-24">
                                                        <input x-model="texts.worstLabel2" class="text-left bg-transparent border-b border-transparent hover:border-webropol-gray-300 focus:outline-none w-24">
                                                        <input x-model="texts.worstLabel3" class="text-left bg-transparent border-b border-transparent hover:border-webropol-gray-300 focus:outline-none w-24">
                                                    </div>
                                                </template>
                                                <template x-if="mode === 'respond'">
                                                    <div class="flex flex-col items-start">
                                                        <span x-text="texts.worstLabel1"></span>
                                                        <span x-text="texts.worstLabel2"></span>
                                                        <span x-text="texts.worstLabel3"></span>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </template>

                                <!-- Horizontal Layout -->
                                <template x-if="orientation === 'horizontal'">
                                    <div class="w-full pt-10 px-4 md:px-16 relative">
                                        <!-- Horizontal Label Row for Icons -->
                                        <div class="flex justify-between items-end mb-4 relative z-0">
                                            <!-- Worst Label (Left) -->
                                            <div class="flex flex-col items-center gap-2 ml-0 md:-ml-8">
                                                <div class="w-12 h-12 rounded-full bg-webropol-gray-50 text-webropol-gray-900 flex items-center justify-center border border-webropol-gray-200 shadow-sm">
                                                    <i class="fa-regular fa-face-frown text-2xl"></i>
                                                </div>
                                                <div class="flex flex-col items-center text-webropol-gray-500 font-bold text-xs tracking-widest uppercase leading-tight text-center">
                                                    <span x-text="texts.worstLabel1"></span>
                                                    <span x-text="texts.worstLabel2"></span>
                                                    <span x-text="texts.worstLabel3"></span>
                                                </div>
                                            </div>
                                            
                                            <!-- Best Label (Right) -->
                                            <div class="flex flex-col items-center gap-2 mr-0 md:-mr-8">
                                                <div class="w-12 h-12 rounded-full bg-webropol-primary-50 text-webropol-primary-700 flex items-center justify-center border border-webropol-primary-100 shadow-sm">
                                                    <i class="fa-regular fa-face-smile text-2xl"></i>
                                                </div>
                                                <div class="flex flex-col items-center text-webropol-primary-700 font-bold text-xs tracking-widest uppercase leading-tight text-center">
                                                    <span x-text="texts.bestLabel1"></span>
                                                    <span x-text="texts.bestLabel2"></span>
                                                    <span x-text="texts.bestLabel3"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Horizontal Track -->
                                        <div class="relative w-full h-32" 
                                             :class="{'pointer-events-none': mode === 'edit'}"
                                             @mousedown="startDragHorizontal"
                                             @touchstart.prevent="startDragHorizontal"
                                             x-ref="trackHorizontal">
                                            
                                            <!-- Interaction Hint -->
                                            <div x-show="value === null" 
                                                 class="absolute top-24 left-1/2 -translate-x-1/2 pointer-events-none transition-opacity duration-500"
                                                 x-transition:leave="duration-500">
                                                <div class="text-webropol-gray-400 font-bold tracking-[0.25em] text-xs uppercase opacity-70 animate-pulse whitespace-nowrap">
                                                    Tap scale to select value
                                                </div>
                                            </div>

                                            <!-- Ticks -->
                                            <template x-for="i in 101">
                                                <div class="absolute top-0 h-full flex flex-col items-center pointer-events-none"
                                                     :style="`left: ${(i-1)}%; transform: translateX(-50%);`"> <!-- 0 is left -->
                                                    <!-- Tick Mark -->
                                                    <div class="w-px bg-gray-400" :class="(i-1) % 10 === 0 ? 'h-8 bg-gray-500' : 'h-4'"></div>
                                                    <!-- Number -->
                                                    <span x-show="(i-1) % 10 === 0" class="mt-2 text-webropol-gray-500 font-medium text-lg text-center tabular-nums select-none" x-text="i-1"></span>
                                                </div>
                                            </template>

                                            <!-- Click Area -->
                                            <div class="absolute -inset-x-4 inset-y-0 cursor-pointer z-10"
                                                 @mousemove="onDragHorizontal" @touchmove.prevent="onDragHorizontal" @mouseup.window="stopDrag" @touchend.window="stopDrag" @click="updateValueHorizontal"></div>

                                            <!-- Horizontal Indicators -->
                                            <div x-show="value !== null" class="absolute h-full pointer-events-none transition-all duration-75 ease-out z-20"
                                                 :style="`left: ${value ?? 50}%; transform: translateX(-50%);`"> <!-- 0 is left -->
                                                
                                                <!-- Dotted line up -->
                                                <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 h-24 border-l-2 border-webropol-gray-400 border-dotted"></div>
                                                
                                                <!-- Value Box -->
                                                <div class="absolute bottom-[232px] left-1/2 -translate-x-1/2 flex flex-col items-center">
                                                    <div class="text-5xl text-[#5c7ae0] font-medium flex items-center gap-1 bg-white px-2 py-1 rounded shadow-sm border border-gray-50">
                                                        <span x-text="Math.round(value)"></span>
                                                    </div>
                                                    <!-- Triangle Pointing Down -->
                                                    <div class="w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[14px] border-t-[#5c7ae0]"></div>
                                                </div>

                                                <!-- Handle Red Dot -->
                                                <div class="absolute top-0 left-1/2 -translate-x-1/2 -mt-[4px] w-6 h-6 bg-[#ee4036] rounded-full shadow-md z-30 ring-2 ring-white scale-125"></div>
                                            </div>
                                        </div>
                                    </div>
                                </template>

                            </div>
                        </div>
                    </div>
                </div>

                    <!-- Settings Modal (Restored to fixed overlay) -->
                    <div x-show="showSettings" 
                         class="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm transition-opacity"
                         x-transition:enter="transition ease-out duration-300" 
                         x-transition:enter-start="opacity-0" 
                         x-transition:enter-end="opacity-100"
                         x-transition:leave="transition ease-in duration-200" 
                         x-transition:leave-start="opacity-100" 
                         x-transition:leave-end="opacity-0"
                         style="display: none;">
                        
                        <!-- Modal Content -->
                        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full overflow-hidden flex flex-col relative z-10 max-h-[90vh]"
                             @click.away="showSettings = false"
                             x-show="showSettings"
                             x-transition:enter="transition ease-out duration-300"
                             x-transition:enter-start="opacity-0 scale-95"
                             x-transition:enter-end="opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-200"
                             x-transition:leave-start="opacity-100 scale-100"
                             x-transition:leave-end="opacity-0 scale-95">
                        
                            <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50 flex-shrink-0">
                                <h3 class="font-bold text-lg text-webropol-gray-900">Question settings</h3>
                                <button @click="showSettings = false" class="text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-200/50 rounded-full"><i class="fa-light fa-times text-xl"></i></button>
                            </div>
                            
                            <div class="p-6 overflow-y-auto flex-1">
                                <!-- Slider Type Selector -->
                            <div class="bg-gray-50/80 p-5 rounded-xl border border-gray-100 mb-6 shadow-sm">
                                 <h4 class="font-bold text-base text-webropol-gray-800 mb-4 flex items-center gap-2">
                                    <span class="w-1 h-4 bg-webropol-primary-500 rounded-full"></span>
                                    Slider Type
                                 </h4>
                                 
                                 <div class="flex gap-6 pt-2 pl-1">
                                    <label class="flex items-center gap-2 cursor-pointer relative z-10">
                                        <input type="radio" name="qtype" value="slider" x-model="questionType" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                        <span class="font-medium text-sm text-gray-700 flex items-center gap-2">
                                            <i class="fa-light fa-sliders text-gray-400"></i>
                                            Slider
                                        </span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer relative z-10">
                                        <input type="radio" name="qtype" value="health-slider" x-model="questionType" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                        <span class="font-medium text-sm text-gray-700 flex items-center gap-2">
                                            <i class="fa-light fa-heart-pulse text-gray-400"></i>
                                            Health Slider
                                        </span>
                                    </label>
                                 </div>
                                 
                                 <!-- Disable switch for Health Slider -->
                                 <div x-show="questionType === 'health-slider'" class="mt-4 pt-4 border-t border-gray-200/60" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0">
                                    <label class="inline-flex items-center gap-3 cursor-pointer select-none group">
                                         <div class="relative">
                                             <input type="checkbox" x-model="settingsDisabled" class="peer sr-only">
                                             <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-webropol-primary-300/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-webropol-primary-600"></div>
                                         </div>
                                         <span class="text-sm font-medium text-gray-700 group-hover:text-webropol-primary-700 transition-colors">Use default settings (disable customization)</span>
                                    </label>
                                 </div>
                            </div>
                            
                            <!-- Detailed Settings Form -->
                            <div class="space-y-6 px-2" :class="{'opacity-40 grayscale pointer-events-none select-none': questionType === 'health-slider' && settingsDisabled}">
                                
                                <!-- Slider Values Section -->
                                <div>
                                    <h4 class="font-bold text-gray-700 mb-4 text-sm">Slider Values</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 mb-4">
                                        <!-- Min Value -->
                                        <div class="flex items-center justify-between">
                                            <label class="text-sm text-gray-600">Minimum value</label>
                                            <input type="number" x-model="settings.min" class="w-24 border-gray-300 rounded px-2 py-1 text-sm focus:ring-webropol-primary-500 focus:border-webropol-primary-500">
                                        </div>
                                        <!-- Unit increase -->
                                        <div class="flex items-center justify-between">
                                            <label class="text-sm text-gray-600">Unit increase</label>
                                            <input type="number" x-model="settings.step" class="w-24 border-gray-300 rounded px-2 py-1 text-sm focus:ring-webropol-primary-500 focus:border-webropol-primary-500">
                                        </div>
                                        <!-- Max Value -->
                                        <div class="flex items-center justify-between">
                                            <label class="text-sm text-gray-600">Maximum value</label>
                                            <input type="number" x-model="settings.max" class="w-24 border-gray-300 rounded px-2 py-1 text-sm focus:ring-webropol-primary-500 focus:border-webropol-primary-500">
                                        </div>
                                        <!-- Starting point -->
                                        <div class="flex items-center justify-between">
                                            <label class="text-sm text-gray-600">Starting point</label>
                                            <input type="number" x-model="settings.start" class="w-24 border-gray-300 rounded px-2 py-1 text-sm focus:ring-webropol-primary-500 focus:border-webropol-primary-500">
                                        </div>
                                        <!-- Value quantity -->
                                        <div class="flex items-center justify-between col-span-1 md:col-span-2 md:w-full">
                                             <label class="text-sm text-gray-600 mr-4">Value quantity (%, $, N...)</label>
                                             <input type="text" x-model="settings.quantity" class="w-24 border-gray-300 rounded px-2 py-1 text-sm focus:ring-webropol-primary-500 focus:border-webropol-primary-500">
                                        </div>
                                    </div>
                                    
                                    <!-- Checkboxes -->
                                    <div class="space-y-3">
                                        <label class="flex items-center gap-2 cursor-pointer w-fit">
                                            <input type="checkbox" x-model="settings.showValue" class="rounded text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                            <span class="text-sm text-gray-700">Show value for the respondent</span>
                                        </label>
                                        
                                        <div class="flex flex-wrap items-center gap-4">
                                             <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" x-model="settings.showDontKnow" class="rounded text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                                <span class="text-sm text-gray-700">Show "I don't know" option for respondent</span>
                                            </label>
                                            <input type="text" x-model="settings.dontKnowLabel" :disabled="!settings.showDontKnow" class="flex-1 max-w-[200px] bg-gray-50 border-gray-300 text-gray-700 rounded px-3 py-1 text-sm disabled:opacity-50 disabled:bg-gray-100 focus:ring-webropol-primary-500 focus:border-webropol-primary-500">
                                        </div>
                                    </div>
                                </div>

                                <!-- Slider Labels Section -->
                                <div>
                                    <h4 class="font-bold text-gray-700 mb-2 text-sm">Slider Labels</h4>
                                    <label class="flex items-center gap-2 cursor-pointer w-fit">
                                        <input type="checkbox" x-model="settings.showLabels" class="rounded text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                        <span class="text-sm text-gray-700">Show labels</span>
                                    </label>
                                </div>

                                <!-- Positioning Section -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <!-- Min/Max Position -->
                                    <div>
                                        <h4 class="text-sm text-gray-500 mb-3">Min. and Max. value position</h4>
                                        <div class="space-y-3">
                                            <label class="flex items-center gap-2 cursor-pointer w-fit">
                                                <input type="radio" name="min-max-pos" value="min-max" x-model="settings.direction" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                                <span class="text-sm text-gray-700">Min. <i class="fa-regular fa-arrow-right text-xs mx-1"></i> Max.</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer w-fit">
                                                <input type="radio" name="min-max-pos" value="max-min" x-model="settings.direction" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                                <span class="text-sm text-gray-700">Max. <i class="fa-regular fa-arrow-right text-xs mx-1"></i> Min.</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <!-- Slider Placement -->
                                    <div>
                                         <h4 class="text-sm text-gray-500 mb-3">Slider placement</h4>
                                         <div class="space-y-3">
                                            <label class="flex items-center gap-2 cursor-pointer w-fit">
                                                <input type="radio" name="orientation" value="horizontal" x-model="settings.orientation" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                                <span class="text-sm text-gray-700">Horizontally</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer w-fit">
                                                <input type="radio" name="orientation" value="vertical" x-model="settings.orientation" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                                <span class="text-sm text-gray-700">Vertically</span>
                                            </label>
                                         </div>
                                    </div>
                                </div>

                                <div class="border-t border-gray-100"></div>

                                <!-- Description Section -->
                                <div>
                                    <div class="flex items-start gap-2 mb-3">
                                        <input type="checkbox" x-model="settings.showDescription" class="mt-0.5 rounded text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                        <div class="flex items-center">
                                            <span class="text-sm text-gray-700 font-medium mr-2">Show question description</span>
                                            <i class="fa-regular fa-circle-question text-webropol-primary-600 text-lg"></i>
                                        </div>
                                    </div>
                                    
                                    <div class="pl-7 grid grid-rows-2 gap-2" :class="!settings.showDescription ? 'opacity-50 pointer-events-none' : ''">
                                         <div class="flex items-center gap-4">
                                            <span class="text-sm text-gray-400 w-20 text-right">Placement:</span>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="radio" name="desc-place" value="below" x-model="settings.descPlacement" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                                <span class="text-sm text-gray-600">Show below question title</span>
                                            </label>
                                         </div>
                                         <div class="flex items-center gap-4">
                                             <span class="w-20"></span>
                                             <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="radio" name="desc-place" value="above" x-model="settings.descPlacement" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                                <span class="text-sm text-gray-600">Show above question title</span>
                                            </label>
                                         </div>
                                    </div>
                                </div>

                                <div class="border-t border-gray-100"></div>

                                <!-- Visibility Section -->
                                <div class="flex items-center gap-8">
                                    <div class="flex items-center gap-2 text-gray-500">
                                        <i class="fa-light fa-eye-slash text-2xl"></i>
                                        <span class="font-medium text-gray-600">Visibility</span>
                                    </div>
                                    
                                    <div class="flex items-center gap-8">
                                         <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="radio" name="visibility" value="visible" x-model="settings.visibility" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                            <span class="text-sm font-bold text-gray-700">Visible</span>
                                        </label>
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="radio" name="visibility" value="hidden" x-model="settings.visibility" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                            <span class="text-sm font-medium text-gray-600">Hidden</span>
                                        </label>
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="radio" name="visibility" value="disabled" x-model="settings.visibility" class="text-webropol-primary-600 focus:ring-webropol-primary-500 border-gray-300">
                                            <span class="text-sm font-medium text-gray-600">Disabled</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="border-t border-gray-100 mb-2"></div>

                                <!-- Footer Buttons -->
                                <div class="flex items-center justify-between pb-2">
                                    <button class="px-5 py-2 rounded-full border border-gray-300 text-sm font-medium text-gray-600 hover:bg-gray-50 transition-colors">
                                        Save question to library
                                    </button>
                                </div>

                                <div class="flex items-center gap-2 text-webropol-primary-700 font-medium text-sm cursor-pointer hover:underline">
                                    Keywords (0) <i class="fa-solid fa-chevron-right text-xs"></i> <i class="fa-regular fa-circle-question ml-1 text-lg"></i>
                                </div>

                            </div>
                        </div>
                        
                        <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 text-right flex justify-end gap-2 flex-shrink-0">
                             <button @click="showSettings = false" class="px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-full font-medium transition-colors">Cancel</button>
                            <button @click="showSettings = false" class="px-4 py-2 bg-webropol-primary-700 hover:bg-webropol-primary-800 text-white rounded-full font-medium transition-colors">Apply</button>
                        </div>
                    </div>

            </main>
        </div>
    </div>

    <!-- Override modal z-index when active per instructions -->
    <style>
        /* Unified question card styling from surveys/edit.html */
        .question-card{border:1px solid #e2e8f0;border-radius:1.25rem;background:#fff;position:relative;transition:box-shadow .18s ease,border-color .18s ease,background-color .18s ease}
        .question-card:hover{border-color:#d5dde6}
        .question-card.selected{border-color:#06b6d4;background:#f0fdff;box-shadow:0 6px 18px -4px rgba(6,182,212,.25)}
        .question-card-header{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;border-bottom:1px solid #e2e8f0;background:#f8fafc;border-radius:1.25rem 1.25rem 0 0}
        .question-card.selected .question-card-header{background:#e0f7fb;border-color:#bae8f1}

        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        body:has(.fixed.z-\[200\]) webropol-header,
        body:has(.fixed.z-\[200\]) webropol-sidebar {
            z-index: 1 !important;
        }
    </style>

    <script>
        function moduleApp() {
            return {
                fullscreen: false,
                init() { console.log('App initialized'); }
            }
        }

        function healthSlider() {
            return {
                mode: 'edit', // 'edit' | 'respond'
                
                // Settings
                showSettings: false,
                questionType: 'health-slider', // 'slider' | 'health-slider'
                settingsDisabled: true, // Only for health-slider

                settings: {
                    // Slider Values
                    min: 0.00,
                    max: 10.00,
                    step: 1,
                    start: 0,
                    quantity: '',
                    showValue: true,
                    showDontKnow: true,
                    dontKnowLabel: "I don't know",
                    
                    // Slider Labels
                    showLabels: true,
                    
                    // Positions
                    direction: 'min-max', // 'min-max' | 'max-min'
                    orientation: 'vertical', // 'horizontal' | 'vertical'
                    
                    // Description
                    showDescription: false,
                    descPlacement: 'below', // 'below' | 'above'
                    
                    // Visibility
                    visibility: 'visible' // 'visible' | 'hidden' | 'disabled'
                },

                // Sync orientation proxy
                get orientation() { return this.settings.orientation; },
                set orientation(val) { this.settings.orientation = val; },

                value: null,
                dragging: false,
                
                texts: {
                    title: 'Health State Today',
                    instructions: `<ul>
<li>We would like to know how good or bad your health is TODAY.</li>
<li>You will see a scale numbered from 0 to 100.</li>
<li>100 means the best health you can imagine.</li>
<li>0 means the worst health you can imagine.</li>
<li>Please indicate on the scale how your health is TODAY.</li>
</ul>`,
                    boxLabel1: 'YOUR',
                    boxLabel2: 'HEALTH',
                    boxLabel3: 'TODAY',
                    bestLabel1: 'Best health',
                    bestLabel2: 'you can',
                    bestLabel3: 'imagine',
                    worstLabel1: 'Worst health',
                    worstLabel2: 'you can',
                    worstLabel3: 'imagine'
                },
                
                // Vertical Logic
                updateFromEvent(e) {
                    const track = this.$refs.trackVertical;
                    if (!track) return;
                    const rect = track.getBoundingClientRect();
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    
                    let relativeY = clientY - rect.top;
                    if (relativeY < 0) relativeY = 0;
                    if (relativeY > rect.height) relativeY = rect.height;
                    
                    const percent = 100 - (relativeY / rect.height * 100);
                    this.value = Math.round(percent);
                },

                // Horizontal Logic
                updateFromEventHorizontal(e) {
                    const track = this.$refs.trackHorizontal;
                    if (!track) return;
                    const rect = track.getBoundingClientRect();
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    
                    // Left is 0, Right is 100
                    let relativeX = clientX - rect.left;
                    if (relativeX < 0) relativeX = 0;
                    if (relativeX > rect.width) relativeX = rect.width;
                    
                    const percent = (relativeX / rect.width * 100);
                    this.value = Math.round(percent);
                },
                
                startDrag(e) { this.dragging = true; this.updateFromEvent(e); },
                startDragHorizontal(e) { this.dragging = true; this.updateFromEventHorizontal(e); },
                
                onDrag(e) { if (!this.dragging) return; this.updateFromEvent(e); },
                onDragHorizontal(e) { if (!this.dragging) return; this.updateFromEventHorizontal(e); },
                
                stopDrag() { this.dragging = false; },
                
                updateValue(e) { this.updateFromEvent(e); },
                updateValueHorizontal(e) { this.updateFromEventHorizontal(e); }
            }
        }
    </script>
</body>
</html>
