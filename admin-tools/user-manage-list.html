<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin · User Management List</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/50ef2d3cf8.js" crossorigin="anonymous"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'webropol-primary': { 50: '#f0fdff', 100: '#ccf7fe', 200: '#99effd', 300: '#66e0fa', 400: '#22ccf1', 500: '#06b6d4', 600: '#0891b2', 700: '#0e7490', 800: '#155e75', 900: '#164e63' },
            'webropol-gray': { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a' },
            'webropol-green': { 50: '#f0fdf4', 100: '#dcfce7', 200: '#bbf7d0', 300: '#86efac', 400: '#4ade80', 500: '#22c55e', 600: '#16a34a', 700: '#15803d', 800: '#166534', 900: '#14532d' },
            'webropol-red': { 50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5', 400: '#f87171', 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c', 800: '#991b1b', 900: '#7f1d1d' }
          },
          fontFamily: {
            'sans': ['Inter', 'system-ui', 'sans-serif']
          },
          boxShadow: {
            'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
            'card': '0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06)'
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="../design-system/styles/tokens.css" rel="stylesheet" />
  <link href="../design-system/styles/animations.css" rel="stylesheet" />
  <link href="royal-gradient.css" rel="stylesheet" />
  <link rel="stylesheet" href="../design-system/styles/tabs.css">
  <script src="../design-system/components/navigation/Sidebar.js" type="module"></script>
  <script src="../design-system/components/navigation/Header.js" type="module"></script>
  <script src="../design-system/components/navigation/Breadcrumbs.js" type="module"></script>
  <script src="../design-system/components/interactive/FloatingButton.js" type="module"></script>
  <script src="../design-system/components/forms/Dropdown.js" type="module"></script>
  <script src="../design-system/components/forms/Input.js" type="module"></script>
  <script src="../design-system/components/tabs/unified-tabs.js" type="module"></script>
  <script src="../design-system/utils/theme-manager.js" type="module"></script>
  <style>
    [x-cloak]{display:none!important}
    .table-sticky thead th{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(6px)}
    .table-sort{cursor:pointer}
  </style>
    
    <!-- Global Analytics Tracker -->
    <script src="../scripts/analytics-global-tracker.js"></script>
</head>
<body x-data="userListApp()" class="">
  <div class="flex h-screen">
    <webropol-sidebar active="admin-tools" base="../"></webropol-sidebar>

    <div class="flex-1 flex flex-col overflow-hidden">
      <webropol-header username="Admin" show-notifications="true" show-help="true" show-user-menu="true"></webropol-header>

      <div class="bg-white/70 backdrop-blur px-0 sm:px-4">
        <webropol-breadcrumbs trail='[{"label":"Home","url":"../index.html"},{"label":"Admin Tools","url":"index.html"},{"label":"User Management","url":"#"}]'></webropol-breadcrumbs>
      </div>

      <!-- Tabs wrapper to match Admin tools -->
      <div class="bg-white/70 backdrop-blur border-b border-webropol-gray-200">
        <div class="px-6 lg:px-12">
          <div class="webropol-tabs-unified webropol-tabs-rounded-container bg-white rounded-xl p-1 shadow-sm border border-webropol-gray-200" role="tablist" aria-label="User Management Tabs">
            <a href="user-manage-list.html" class="webropol-unified-tab webropol-tab-rounded size-sm active" role="tab" aria-selected="true">User Management and New User Creation</a>
            <a href="#" class="webropol-unified-tab webropol-tab-rounded size-sm" role="tab" aria-selected="false">Survey and Folder Rights</a>
            <a href="#" class="webropol-unified-tab webropol-tab-rounded size-sm" role="tab" aria-selected="false">User Group Management</a>
            <a href="#" class="webropol-unified-tab webropol-tab-rounded size-sm" role="tab" aria-selected="false">Access Requests <span class="ml-1 text-xs bg-webropol-gray-100 text-webropol-gray-600 px-2 py-0.5 rounded-full">(0)</span></a>
          </div>
        </div>
      </div>

      <main class="flex-1 overflow-y-auto" role="main">
        <div class="max-w-7xl mx-auto">

          <!-- Modern Header -->
          <div class="mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
              <div>
                <h1 class="text-3xl font-bold text-webropol-gray-900">Team Members</h1>
                <p class="mt-2 text-sm text-webropol-gray-600">Manage your team members and their account settings.</p>
              </div>
              <div class="flex items-center gap-3">
                <button @click="exportUsers()" class="inline-flex items-center px-4 py-2 border border-webropol-gray-300 rounded-full text-sm font-medium text-webropol-gray-700 bg-white hover:bg-webropol-gray-50 hover:border-webropol-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-webropol-primary-500 transition-colors">
                  <i class="fal fa-download mr-2"></i>
                  Export
                </button>
                <a href="./user-management.html" class="inline-flex items-center px-4 py-2 bg-webropol-primary-600 border border-transparent rounded-full text-sm font-medium text-white hover:bg-webropol-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-webropol-primary-500 shadow-sm transition-colors">
                  <i class="fal fa-plus mr-2"></i>
                  Add member
                </a>
              </div>
            </div>
          </div>

          <!-- Modern Search & Filters -->
          <div class="mb-6">
            <div class="bg-white rounded-xl border border-webropol-gray-200 p-6 shadow-sm">
              <div class="flex flex-col sm:flex-row gap-4">
                <div class="flex-1">
                  <webropol-input
                    icon="search"
                    placeholder="Search team members..."
                    :value="filters.query"
                    @webropol-input-change.debounce.300ms="filters.query = $event.detail.value"
                  ></webropol-input>
                </div>
                <div class="flex items-center gap-3">
                  <webropol-dropdown
                    :value="filters.field"
                    @change="filters.field = $event.detail.value"
                    options='[{"label":"All fields","value":"all"},{"label":"Username","value":"userName"},{"label":"Name","value":"name"},{"label":"Email","value":"email"},{"label":"Status","value":"status"}]'
                  ></webropol-dropdown>
                  <button @click="resetFilters()" class="px-4 py-2.5 text-sm text-webropol-gray-500 hover:text-webropol-gray-700 hover:bg-webropol-gray-100 rounded-full transition-colors">
                    Clear
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Modern Table Card -->
          <div class="bg-white rounded-xl border border-webropol-gray-200 shadow-sm overflow-hidden">
            <!-- Table Header with Stats -->
            <div class="px-6 py-4 border-b border-webropol-gray-200 bg-webropol-gray-50">
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div class="flex items-center gap-4">
                  <div class="flex items-center">
                    <input type="checkbox" @change="toggleAll($event)" :checked="allVisibleSelected" 
                           class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                    <span class="ml-3 text-sm text-webropol-gray-700" x-text="`${selected.size} selected`"></span>
                  </div>
                  <button x-show="selected.size > 0" @click="bulkDelete()" 
                          class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors shadow-sm"
                          style="background-color: #dc2626; border: none;"
                          onmouseover="this.style.backgroundColor='#b91c1c'"
                          onmouseout="this.style.backgroundColor='#dc2626'">
                    <i class="fa-light fa-trash-can mr-1"></i>
                    Delete selected
                  </button>
                </div>
                <div class="flex items-center gap-4 text-sm text-webropol-gray-600">
                  <span x-text="rangeText"></span>
                </div>
              </div>
            </div>

            <!-- Responsive Table -->
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-webropol-gray-200">
                <thead class="bg-webropol-gray-50">
                  <tr>
                    <th scope="col" class="w-4 px-6 py-3"></th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-webropol-gray-500 uppercase tracking-wider cursor-pointer hover:bg-webropol-gray-100" @click="toggleSort('userName')">
                      <div class="flex items-center gap-2">
                        Username
                        <i :class="sortIcon('userName')" class="text-webropol-gray-400"></i>
                      </div>
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-webropol-gray-500 uppercase tracking-wider cursor-pointer hover:bg-webropol-gray-100" @click="toggleSort('name')">
                      <div class="flex items-center gap-2">
                        Name
                        <i :class="sortIcon('name')" class="text-webropol-gray-400"></i>
                      </div>
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-webropol-gray-500 uppercase tracking-wider cursor-pointer hover:bg-webropol-gray-100" @click="toggleSort('email')">
                      <div class="flex items-center gap-2">
                        Email
                        <i :class="sortIcon('email')" class="text-webropol-gray-400"></i>
                      </div>
                    </th>
                    <th scope="col" class="hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-webropol-gray-500 uppercase tracking-wider cursor-pointer hover:bg-webropol-gray-100" @click="toggleSort('userClass')">
                      <div class="flex items-center gap-2">
                        Role
                        <i :class="sortIcon('userClass')" class="text-webropol-gray-400"></i>
                      </div>
                    </th>
                    <th scope="col" class="hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-webropol-gray-500 uppercase tracking-wider cursor-pointer hover:bg-webropol-gray-100" @click="toggleSort('lastLogin')">
                      <div class="flex items-center gap-2">
                        Last login
                        <i :class="sortIcon('lastLogin')" class="text-webropol-gray-400"></i>
                      </div>
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-webropol-gray-500 uppercase tracking-wider cursor-pointer hover:bg-webropol-gray-100" @click="toggleSort('status')">
                      <div class="flex items-center gap-2">
                        Status
                        <i :class="sortIcon('status')" class="text-webropol-gray-400"></i>
                      </div>
                    </th>
                    <th scope="col" class="hidden xl:table-cell px-6 py-3 text-left text-xs font-medium text-webropol-gray-500 uppercase tracking-wider cursor-pointer hover:bg-webropol-gray-100" @click="toggleSort('surveysCreated')">
                      <div class="flex items-center gap-2">
                        Surveys
                        <i :class="sortIcon('surveysCreated')" class="text-webropol-gray-400"></i>
                      </div>
                    </th>
                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-webropol-gray-500 uppercase tracking-wider">
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-webropol-gray-200">
                  <template x-for="u in pagedUsers" :key="u.id">
                    <tr class="hover:bg-webropol-gray-50 transition-colors duration-150">
                      <td class="px-6 py-4">
                        <input type="checkbox" :value="u.id" @change="toggleSelect(u.id)" :checked="selected.has(u.id)"
                               class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <a :href="detailHref(u)" class="text-sm font-medium text-webropol-primary-600 hover:text-webropol-primary-900" x-text="u.userName"></a>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div class="flex-shrink-0 h-10 w-10">
                            <div class="h-10 w-10 rounded-full bg-webropol-gray-200 flex items-center justify-center">
                              <span class="text-sm font-medium text-webropol-gray-700" x-text="(u.firstName?.[0] || '') + (u.lastName?.[0] || '')"></span>
                            </div>
                          </div>
                          <div class="ml-4">
                            <a :href="detailHref(u)" class="text-sm font-medium text-webropol-gray-900 hover:text-webropol-primary-600" 
                               x-text="`${u.firstName || ''} ${u.lastName || ''}`.trim()"></a>
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-webropol-gray-900" x-text="u.email"></div>
                      </td>
                      <td class="hidden md:table-cell px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                              :class="u.userClass === 'Admin' ? 'bg-webropol-purple-100 text-webropol-purple-800' : 
                                      u.userClass === 'User' ? 'bg-webropol-blue-100 text-webropol-blue-800' : 
                                      'bg-webropol-gray-100 text-webropol-gray-800'"
                              x-text="u.userClass"></span>
                      </td>
                      <td class="hidden lg:table-cell px-6 py-4 whitespace-nowrap text-sm text-webropol-gray-500" x-text="u.lastLogin || 'Never'"></td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                              :class="u.status === 'Active' ? 'bg-webropol-green-100 text-webropol-green-800' : 'bg-webropol-red-100 text-webropol-red-800'"
                              x-text="u.status"></span>
                      </td>
                      <td class="hidden xl:table-cell px-6 py-4 whitespace-nowrap text-sm text-webropol-gray-500" x-text="u.surveysCreated"></td>
                      <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <div class="relative" x-data="{ open: false }">
                          <button @click="open = !open" @click.away="open = false"
                                  class="inline-flex items-center justify-center w-8 h-8 rounded-full text-webropol-gray-400 hover:text-webropol-gray-600 hover:bg-webropol-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-webropol-primary-500 transition-colors">
                            <i class="fal fa-ellipsis-v"></i>
                          </button>
                          <div x-show="open" x-transition
                               class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-webropol-gray-200 py-1 z-50">
                            <button @click="sendValidation(u); open = false" 
                                    class="w-full text-left px-4 py-2 text-sm text-webropol-gray-700 hover:bg-webropol-gray-50 flex items-center whitespace-nowrap">
                              <i class="fal fa-envelope w-4 mr-3 text-webropol-gray-400 flex-shrink-0"></i>
                              <span>Send validation link</span>
                            </button>
                            <button @click="resetPassword(u); open = false" 
                                    class="w-full text-left px-4 py-2 text-sm text-webropol-gray-700 hover:bg-webropol-gray-50 flex items-center whitespace-nowrap">
                              <i class="fal fa-key w-4 mr-3 text-webropol-gray-400 flex-shrink-0"></i>
                              <span>Reset password</span>
                            </button>
                            <hr class="my-1 border-webropol-gray-100">
                            <button @click="manageAccessRights(u); open = false" 
                                    class="w-full text-left px-4 py-2 text-sm text-webropol-gray-700 hover:bg-webropol-gray-50 flex items-center whitespace-nowrap">
                              <i class="fal fa-shield-alt w-4 mr-3 text-webropol-gray-400 flex-shrink-0"></i>
                              <span>Access rights for user</span>
                            </button>
                            <button @click="manageUserGroups(u); open = false" 
                                    class="w-full text-left px-4 py-2 text-sm text-webropol-gray-700 hover:bg-webropol-gray-50 flex items-center whitespace-nowrap">
                              <i class="fal fa-users w-4 mr-3 text-webropol-gray-400 flex-shrink-0"></i>
                              <span>User group membership</span>
                            </button>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>            <!-- Modern Pagination -->
            <div class="px-6 py-4 bg-white border-t border-webropol-gray-200">
              <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div class="flex items-center gap-4">
                  <div class="flex items-center gap-2 text-sm text-webropol-gray-700">
                    <span>Rows per page:</span>
                    <webropol-dropdown
                      :value="pageSize"
                      @change="pageSize = $event.detail.value; page = 1"
                      options='[{"label":"20","value":20},{"label":"50","value":50},{"label":"100","value":100}]'
                    ></webropol-dropdown>
                  </div>
                </div>
                <div class="flex items-center gap-4">
                  <span class="text-sm text-webropol-gray-700" x-text="rangeText"></span>
                  <div class="flex items-center gap-1">
                    <button @click="prevPage()" :disabled="page === 1" 
                            class="p-2 rounded-full border border-webropol-gray-300 text-webropol-gray-500 hover:bg-webropol-gray-50 hover:border-webropol-gray-400 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-webropol-primary-500 transition-colors">
                      <i class="fal fa-chevron-left"></i>
                    </button>
                    <button @click="nextPage()" :disabled="page === totalPages"
                            class="p-2 rounded-full border border-webropol-gray-300 text-webropol-gray-500 hover:bg-webropol-gray-50 hover:border-webropol-gray-400 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-webropol-primary-500 transition-colors">
                      <i class="fal fa-chevron-right"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Access Rights Modal -->
  <div x-show="accessRightsModal.show" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
      <div x-show="accessRightsModal.show" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="fixed inset-0 transition-opacity bg-webropol-gray-500 bg-opacity-75" @click="accessRightsModal.show = false"></div>
      
      <div x-show="accessRightsModal.show" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100" x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-6xl sm:w-full">
        
        <!-- Modal Header -->
        <div class="bg-white px-6 pt-6 pb-4 border-b border-webropol-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-medium text-webropol-gray-900">
              Survey and Folder access rights: 
              <span class="text-webropol-primary-600" x-text="accessRightsModal.user?.userName || ''"></span>
            </h3>
            <button @click="accessRightsModal.show = false" class="text-webropol-gray-400 hover:text-webropol-gray-600 transition-colors">
              <i class="fal fa-times text-xl"></i>
            </button>
          </div>
        </div>

        <!-- Modal Content -->
        <div class="bg-white px-6 py-4">
          <!-- Top Controls -->
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
            <div class="flex items-center gap-4">
              <select x-model="accessRightsModal.selectedType" class="border border-webropol-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-webropol-primary-500 focus:border-webropol-primary-500">
                <option value="Survey&Reporting">Survey&Reporting</option>
                <option value="BI">BI</option>
                <option value="Community">Community</option>
              </select>
              <button class="text-webropol-gray-400 hover:text-webropol-gray-600">
                <i class="fal fa-question-circle"></i>
              </button>
            </div>
            
            <div class="flex items-center gap-4">
              <div class="relative">
                <input type="text" x-model="accessRightsModal.searchQuery" placeholder="Search for surveys" class="pl-10 pr-4 py-2 border border-webropol-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-webropol-primary-500 focus:border-webropol-primary-500 w-80">
                <i class="fal fa-search absolute left-3 top-3 text-webropol-gray-400"></i>
              </div>
              <label class="flex items-center gap-2 text-sm text-webropol-gray-700">
                <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                Filter to show only surveys and folders with assigned rights for user
              </label>
              <button class="px-4 py-2 bg-webropol-gray-100 text-webropol-gray-700 text-sm rounded-md hover:bg-webropol-gray-200 transition-colors">
                Filter
              </button>
            </div>
          </div>

          <!-- Access Rights Table -->
          <div class="border border-webropol-gray-200 rounded-lg overflow-hidden">
            <table class="min-w-full divide-y divide-webropol-gray-200">
              <thead class="bg-webropol-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-webropol-gray-500 uppercase tracking-wider w-1/2">
                    Folders and surveys.
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-webropol-gray-500 uppercase tracking-wider w-1/6">
                    Survey ID
                  </th>
                  <th class="px-6 py-3 text-center text-xs font-medium text-webropol-gray-500 uppercase tracking-wider w-1/6">
                    <div class="flex items-center justify-center gap-1">
                      Read
                      <span class="inline-flex items-center justify-center w-5 h-5 bg-webropol-primary-500 text-white text-xs rounded-full">1</span>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-center text-xs font-medium text-webropol-gray-500 uppercase tracking-wider w-1/6">
                    <div class="flex items-center justify-center gap-1">
                      Write
                      <span class="inline-flex items-center justify-center w-5 h-5 bg-webropol-primary-500 text-white text-xs rounded-full">1</span>
                    </div>
                  </th>
                  <th class="px-6 py-3 text-center text-xs font-medium text-webropol-gray-500 uppercase tracking-wider w-1/6">
                    <div class="flex items-center justify-center gap-1">
                      Manage
                      <span class="inline-flex items-center justify-center w-5 h-5 bg-webropol-primary-500 text-white text-xs rounded-full">1</span>
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-webropol-gray-200">
                <!-- Folder: Janne EXW -->
                <tr class="hover:bg-webropol-gray-50">
                  <td class="px-6 py-4 text-sm">
                    <div class="flex items-center">
                      <i class="fal fa-folder text-webropol-gray-400 mr-2"></i>
                      <span class="font-medium text-webropol-gray-900">Janne EXW</span>
                    </div>
                  </td>
                  <td class="px-6 py-4 text-sm text-webropol-gray-500"></td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                </tr>
                
                <!-- Survey: texw rule -->
                <tr class="hover:bg-webropol-gray-50">
                  <td class="px-6 py-4 text-sm">
                    <div class="flex items-center pl-8">
                      <span class="text-webropol-gray-700">texw rule</span>
                    </div>
                  </td>
                  <td class="px-6 py-4 text-sm text-webropol-gray-500">Fin345690</td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                </tr>

                <!-- Survey: exw library rule test -->
                <tr class="hover:bg-webropol-gray-50">
                  <td class="px-6 py-4 text-sm">
                    <div class="flex items-center pl-8">
                      <span class="text-webropol-gray-700">exw library rule test</span>
                    </div>
                  </td>
                  <td class="px-6 py-4 text-sm text-webropol-gray-500">Fin345692</td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                </tr>

                <!-- Survey: exw test -->
                <tr class="hover:bg-webropol-gray-50">
                  <td class="px-6 py-4 text-sm">
                    <div class="flex items-center pl-8">
                      <span class="text-webropol-gray-700">exw test</span>
                    </div>
                  </td>
                  <td class="px-6 py-4 text-sm text-webropol-gray-500">Fin324234</td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                </tr>

                <!-- Folder: Mika EXW -->
                <tr class="hover:bg-webropol-gray-50">
                  <td class="px-6 py-4 text-sm">
                    <div class="flex items-center">
                      <i class="fal fa-folder text-webropol-gray-400 mr-2"></i>
                      <span class="font-medium text-webropol-gray-900">Mika EXW</span>
                    </div>
                  </td>
                  <td class="px-6 py-4 text-sm text-webropol-gray-500"></td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                </tr>

                <!-- More surveys... -->
                <tr class="hover:bg-webropol-gray-50">
                  <td class="px-6 py-4 text-sm">
                    <div class="flex items-center pl-8">
                      <span class="text-webropol-gray-700">test_exw</span>
                    </div>
                  </td>
                  <td class="px-6 py-4 text-sm text-webropol-gray-500">Fin330895</td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                  <td class="px-6 py-4 text-center">
                    <input type="checkbox" class="h-4 w-4 text-webropol-primary-600 focus:ring-webropol-primary-500 border-webropol-gray-300 rounded">
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="bg-webropol-gray-50 px-6 py-4 border-t border-webropol-gray-200">
          <div class="flex justify-end gap-3">
            <button @click="accessRightsModal.show = false" class="px-4 py-2 text-sm font-medium text-webropol-gray-700 bg-white border border-webropol-gray-300 rounded-full hover:bg-webropol-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-webropol-primary-500 transition-colors">
              Cancel
            </button>
            <button class="px-4 py-2 text-sm font-medium text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors"
                    style="background-color: #ff8c00; border: none;"
                    onmouseover="this.style.backgroundColor='#e67c00'"
                    onmouseout="this.style.backgroundColor='#ff8c00'">
              Apply
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <webropol-floating-button></webropol-floating-button>

  <script>
    function userListApp(){
      function mockUsers(count=150){
        const firstNames = ['Hanna','Juho','Marika','Adrian','Mahfuzul','Teppo','Janne','Elenore','Anna','Mika','Ayan','Sara','Olli','Veera','Lauri','Kalle','Noora','Matti','Sanna','Ville','Timo','Elina','Iida','Paula','Petri','Katja','Emma','Oskari','Aino','Eetu','Helmi','Onni','Ella','Oliver','Sofia','Leo','Aada','Elias','Livia','Väinö','Alina','Eino','Luna','Niilo','Aura','Leevi','Isla','Hugo','Elli','Aapo','Pihla'];
        const lastNames = ['Björklund','Jokinen','Poghosyan','Varmenus','Haque','Marin','Laukkanen','Klinga','Gotkowicz','Textila','Das','Korhonen','Salmi','Virtanen','Nieminen','Heikkinen','Lehtonen','Savolainen','Laine','Hämäläinen','Koski','Mäkinen','Kinnunen','Tuominen','Mustonen','Ojala','Peltonen','Rantanen','Laaksonen','Hakkarainen','Salo','Huhtala','Manninen','Rautio','Karjalainen','Niemi','Snellman','Westerberg','Lindqvist','Aaltonen','Saarinen','Moilanen','Rajala','Kallio','Nykänen','Hiltunen','Sorsa','Järvinen'];
        const roles = ['Admin','User','Viewer'];
        const biRoles = ['-','BI VIEW user','BI VIEW Admin'];
        const pad = n => String(n).padStart(2,'0');
        const users = [];
        const usedCombinations = new Set();
        
        for(let i=0; i<count && users.length < count; i++){
          let fn, ln, combination;
          let attempts = 0;
          
          // Try to find a unique name combination
          do {
            const fnIndex = (i + attempts) % firstNames.length;
            const lnIndex = (i * 7 + attempts * 3) % lastNames.length;
            fn = firstNames[fnIndex];
            ln = lastNames[lnIndex];
            combination = `${fn}-${ln}`;
            attempts++;
          } while (usedCombinations.has(combination) && attempts < 100);
          
          // If we couldn't find a unique combination, skip this iteration
          if (usedCombinations.has(combination)) continue;
          
          usedCombinations.add(combination);
          
          const uname = `${fn}.${ln}`.toLowerCase().replace(/[^a-z]/g,'');
          const email = `${fn}.${ln}@example.com`.toLowerCase();
          const userClass = roles[i % roles.length];
          const biViewClass = biRoles[(i+1) % biRoles.length];
          const status = i % 17 === 0 ? 'Disabled' : 'Active';
          const surveysCreated = (i * 13) % 250;
          const year = 2019 + (i % 7);
          const month = pad((i % 12)+1);
          const day = pad((i*3 % 28)+1);
          const created = `${day}.${month}.${year}`;
          const lastLogin = i % 9 === 0 ? 'Never' : `${pad((i*5 % 28)+1)}.${pad(((i+2)%12)+1)}.${2020+(i%6)}`;
          users.push({id:users.length+1,userName:uname,firstName:fn,lastName:ln,email,userClass,biViewClass,lastLogin,status,surveysCreated,created});
        }
        return users;
      }
      const sample = mockUsers(180);
      return {
        // data
        users: sample,
        filters: { field:'all', match:'Contains', query:'' },
        sort: { key:'userName', dir:'asc' },
        selected: new Set(),
        page: 1,
        pageSize: 20,
        accessRightsModal: { show: false, user: null, searchQuery: '', selectedType: 'Survey&Reporting' },

        // computed
        get filtered(){
          const q = this.filters.query?.toLowerCase() || '';
          if(!q) return this.users.slice();
          return this.users.filter(u=>{
            let v = '';
            if(this.filters.field==='all') {
              v = [u.userName, u.firstName, u.lastName, u.email, u.userClass, u.biViewClass, u.status].filter(Boolean).join(' ').toLowerCase();
            } else if(this.filters.field==='name') {
              v = `${u.firstName ?? ''} ${u.lastName ?? ''}`.trim().toLowerCase();
            } else {
              v = String(u[this.filters.field] ?? '').toLowerCase();
            }
            if(this.filters.match==='Contains') return v.includes(q);
            if(this.filters.match==='Equals') return v===q;
            if(this.filters.match==='Starts with') return v.startsWith(q);
            if(this.filters.match==='Ends with') return v.endsWith(q);
            return true;
          });
        },
        get sorted(){
          return this.filtered.slice().sort((a,b)=>{
            let ak,bk;
            if(this.sort.key==='name') {
              ak = `${a.lastName ?? ''} ${a.firstName ?? ''}`.toLowerCase();
              bk = `${b.lastName ?? ''} ${b.firstName ?? ''}`.toLowerCase();
            } else if(this.sort.key==='lastLogin') {
              // Handle 'Never' as earliest date for sorting
              ak = a.lastLogin === 'Never' ? '01.01.1900' : a.lastLogin;
              bk = b.lastLogin === 'Never' ? '01.01.1900' : b.lastLogin;
              // Convert date format DD.MM.YYYY to YYYY-MM-DD for proper sorting
              if(ak !== '01.01.1900') {
                const [d1, m1, y1] = ak.split('.');
                ak = `${y1}-${m1.padStart(2,'0')}-${d1.padStart(2,'0')}`;
              }
              if(bk !== '01.01.1900') {
                const [d2, m2, y2] = bk.split('.');
                bk = `${y2}-${m2.padStart(2,'0')}-${d2.padStart(2,'0')}`;
              }
            } else if(this.sort.key==='surveysCreated') {
              // Handle numeric sorting
              ak = parseInt(a[this.sort.key]) || 0;
              bk = parseInt(b[this.sort.key]) || 0;
              return (ak > bk ? 1 : ak < bk ? -1 : 0) * (this.sort.dir === 'asc' ? 1 : -1);
            } else {
              ak = String(a[this.sort.key] ?? '').toLowerCase();
              bk = String(b[this.sort.key] ?? '').toLowerCase();
            }
            return (ak>bk?1:ak<bk?-1:0) * (this.sort.dir==='asc'?1:-1);
          });
        },
        get totalPages(){ return Math.max(1, Math.ceil(this.sorted.length / this.pageSize)); },
        get pagedUsers(){
          const start=(this.page-1)*this.pageSize; return this.sorted.slice(start, start+this.pageSize);
        },
        get allVisibleSelected(){
          return this.pagedUsers.length>0 && this.pagedUsers.every(u=>this.selected.has(u.id));
        },
        get rangeText(){
          const total = this.sorted.length; const from = (this.page-1)*this.pageSize + 1; const to = Math.min(this.page*this.pageSize, total);
          return `Showing ${from}-${to} of ${total}`;
        },

        // methods
        toggleSort(key){
          if(this.sort.key===key){ this.sort.dir = this.sort.dir==='asc'?'desc':'asc'; }
          else { this.sort.key = key; this.sort.dir='asc'; }
        },
        sortIcon(key){
          if(this.sort.key!==key) return 'fal fa-sort text-webropol-gray-400 ml-1';
          return this.sort.dir==='asc' ? 'fal fa-sort-up text-webropol-primary-600 ml-1' : 'fal fa-sort-down text-webropol-primary-600 ml-1';
        },
        applyFilters(){ this.page = 1; },
        resetFilters(){ this.filters = { field:'all', match:'Contains', query:'' }; this.page = 1; },
        toggleSelect(id){ this.selected.has(id) ? this.selected.delete(id) : this.selected.add(id); },
        toggleAll(e){
          if(e.target.checked){ this.pagedUsers.forEach(u=>this.selected.add(u.id)); }
          else { this.pagedUsers.forEach(u=>this.selected.delete(u.id)); }
        },
        setPageSize(n){ this.pageSize = n; this.page = 1; },
        exportUsers(){ this.toast('Export feature coming soon!'); },
        nextPage(){ if(this.page < this.totalPages) this.page++; },
        prevPage(){ if(this.page > 1) this.page--; },
  detailHref(u){ return `./admin-tools/user-management.html?user=${encodeURIComponent(u.userName)}`; },
  openUser(u){ window.location.href = this.detailHref(u); },
        sendValidation(u){ this.toast(`Validation link sent to ${u.email}`); },
        resetPassword(u){ this.toast(`Password reset requested for ${u.userName}`); },
        manageAccessRights(u){ 
          this.accessRightsModal.user = u;
          this.accessRightsModal.show = true;
        },
        manageUserGroups(u){ this.toast(`Opening user group membership for ${u.userName}`); },
        bulkDelete(){ this.toast(`${this.selected.size} user(s) queued for deletion`); this.selected.clear(); },
        toast(msg){
          const el = document.createElement('div');
          el.className = 'fixed bottom-6 right-6 bg-webropol-gray-900 text-white px-4 py-3 rounded-xl shadow-soft z-50';
          el.textContent = msg; document.body.appendChild(el); setTimeout(()=>el.remove(), 2200);
        }
      }
    }
  </script>
</body>
</html>
