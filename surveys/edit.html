<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Survey - Translation | Webropol</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/50ef2d3cf8.js" crossorigin="anonymous"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'webropol-teal': { 50: '#f0fdff', 100: '#ccf7fe', 200: '#99effd', 300: '#66e0fa', 400: '#22ccf1', 500: '#06b6d4', 600: '#0891b2', 700: '#0e7490', 800: '#155e75', 900: '#164e63' },
            'webropol-gray': { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a' },
            'webropol-teal-': { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a' },
          },
          fontFamily: {
            'sans': ['Inter', 'system-ui', 'sans-serif'],
          },
          boxShadow: {
            'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
            'medium': '0 4px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
            'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --border-radius-full: 9999px;
      --primary-600: #1d809d;
    }

    [x-cloak] {
      display: none !important;
    }

    body {
      scrollbar-width: thin;
      scrollbar-color: #cbd5e1 #f8fafc;
      font-family: 'Inter', sans-serif;
    }

    body::-webkit-scrollbar {
      width: 6px;
    }

    body::-webkit-scrollbar-track {
      background: #f8fafc;
    }

    body::-webkit-scrollbar-thumb {
      background-color: #cbd5e1;
      border-radius: 6px;
    }

    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.9);
    }

    .hover-lift {
      transition: all 0.2s ease;
    }

    .hover-lift:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 25px -5px rgba(0, 0, 0, 0.15);
    }
  </style>
  <script src="../design-system/components/navigation/Sidebar.js" type="module"></script>
  <script src="../design-system/components/navigation/Header.js" type="module"></script>
  <script src="../design-system/components/navigation/Breadcrumbs.js" type="module"></script>
  <script src="../design-system/components/interactive/FloatingButton.js" type="module"></script>
</head>
<body class="bg-gradient-to-br from-webropol-teal-50 to-webropol-teal-50/30" style="background-color: #ebf4f7;" x-data="surveyEditApp()">
  <div class="flex h-screen">
    <webropol-sidebar active="surveys" base="../"></webropol-sidebar>
    <div class="flex-1 flex flex-col overflow-hidden">
      <webropol-header username="Ali Al-Zuhairi" show-notifications="true" show-help="true" show-user-menu="true"></webropol-header>
      <div class="bg-white/70 backdrop-blur px-0 sm:px-4">
        <webropol-breadcrumbs trail='[{"label":"Home","url":"../index.html"},{"label":"Surveys","url":"index.html"},{"label":"Edit","url":"edit.html"}]'></webropol-breadcrumbs>
      </div>

      <main class="flex-1 overflow-y-auto px-6 py-6 lg:px-12" role="main">
        <div class="max-w-7xl mx-auto">
          <!-- Survey Editor Header -->
          <div class="mb-8">
            <div class="flex items-center justify-between mb-6">
              <div>
                <h1 class="text-3xl font-bold text-webropol-gray-900 mb-2">Edit Survey</h1>
                <div class="flex items-center space-x-6 text-sm text-webropol-gray-500">
                  <span class="flex items-center">
                    <i class="fal fa-file-alt mr-2"></i>
                    Translation Survey
                  </span>
                  <span class="flex items-center">
                    <i class="fal fa-calendar mr-2"></i>
                    Created Aug 19, 2025
                  </span>
                  <span class="flex items-center">
                    <i class="fal fa-clock mr-2"></i>
                    Last saved 2 min ago
                  </span>
                </div>
              </div>
              
              <div class="flex items-center space-x-3">
                <button class="btn btn-secondary">
                  <i class="fal fa-eye"></i>
                  <span>Preview & test</span>
                </button>
                <button class="btn btn-primary">
                  <i class="fal fa-save"></i>
                  <span>Save & Close</span>
                </button>
              </div>
            </div>

            <!-- Action Tabs -->
            <div class="flex bg-webropol-teal-50 p-1.5 rounded-xl shadow-soft border border-webropol-teal-100 gap-1 mb-6">
              <button class="px-6 py-3 rounded-xl font-semibold bg-webropol-teal-600 text-white shadow-lg transform scale-[1.02] flex items-center space-x-2">
                <i class="fal fa-edit"></i>
                <span>Edit</span>
              </button>
              <button class="px-6 py-3 rounded-xl font-semibold text-webropol-gray-600 hover:text-webropol-teal-700 hover:bg-white hover:shadow-md hover:scale-[1.01] transition-all duration-300 ease-out flex items-center space-x-2">
                <i class="fal fa-chart-bar"></i>
                <span>Collect answers</span>
              </button>
              <button class="px-6 py-3 rounded-xl font-semibold text-webropol-gray-600 hover:text-webropol-teal-700 hover:bg-white hover:shadow-md hover:scale-[1.01] transition-all duration-300 ease-out flex items-center space-x-2">
                <i class="fal fa-eye"></i>
                <span>Follow up</span>
              </button>
              <button class="px-6 py-3 rounded-xl font-semibold text-webropol-gray-600 hover:text-webropol-teal-700 hover:bg-white hover:shadow-md hover:scale-[1.01] transition-all duration-300 ease-out flex items-center space-x-2">
                <i class="fal fa-chart-line"></i>
                <span>Reporting</span>
              </button>
              <button class="px-6 py-3 rounded-xl font-semibold text-webropol-gray-600 hover:text-webropol-teal-700 hover:bg-white hover:shadow-md hover:scale-[1.01] transition-all duration-300 ease-out flex items-center space-x-2">
                <i class="fal fa-brain"></i>
                <span>AI Text Analysis</span>
              </button>
            </div>
          </div>
          </div>

          <!-- Survey Editor Layout -->
          <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Left Sidebar - Survey Structure -->
            <div class="lg:col-span-1">
              <div class="bg-white/90 backdrop-blur-lg rounded-3xl p-6 shadow-xl border border-webropol-gray-100/80 hover-lift">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="font-semibold text-webropol-gray-900">Survey structure</h3>
                  <button class="text-webropol-gray-400 hover:text-webropol-gray-600">
                    <i class="fal fa-ellipsis-h"></i>
                  </button>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-2 mb-4">
                  <button class="btn btn-secondary">
                    <i class="fal fa-arrows-alt text-xs"></i>
                    <span>Move</span>
                  </button>
                  <button class="btn btn-secondary">
                    <i class="fal fa-copy text-xs"></i>
                    <span>Copy</span>
                  </button>
                  <button class="btn btn-secondary">
                    <i class="fal fa-trash text-xs"></i>
                    <span>Delete</span>
                  </button>
                </div>
                
                <!-- Survey Structure Tree -->
                <div class="space-y-3 mb-6">
                  <!-- Page 1 -->
                  <div class="flex items-center space-x-3 p-3 bg-webropol-teal-50 rounded-lg border border-webropol-teal-200">
                    <i class="fal fa-chevron-down text-webropol-teal-600"></i>
                    <i class="fal fa-file-alt text-webropol-teal-600"></i>
                    <span class="font-medium text-webropol-teal-900">PAGE 1</span>
                  </div>
                  
                  <!-- Auto Suggest Question -->
                  <div class="ml-6 flex items-center space-x-3 p-3 bg-blue-50 rounded-lg border border-blue-200 cursor-pointer hover:bg-blue-100 transition-colors">
                    <i class="fal fa-grip-vertical text-blue-400"></i>
                    <i class="fal fa-list-ul text-blue-600"></i>
                    <span class="text-blue-900 font-medium">Auto Suggest</span>
                  </div>
                  
                  <!-- Thank you page -->
                  <div class="flex items-center space-x-3 p-3 hover:bg-webropol-gray-50 rounded-lg cursor-pointer transition-colors">
                    <i class="fal fa-heart text-green-600"></i>
                    <span class="text-webropol-gray-700">Thank you page</span>
                  </div>
                </div>
                
                <!-- Add Content Section -->
                <div class="space-y-3">
                  <button class="btn btn-primary w-full">
                    <i class="fal fa-plus"></i>
                    <span>Add question</span>
                  </button>
                  <button class="btn btn-secondary w-full">
                    <i class="fal fa-text"></i>
                    <span>Add free text/media</span>
                  </button>
                  <button class="btn btn-secondary w-full">
                    <i class="fal fa-cut"></i>
                    <span>Add page break</span>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Main Canvas Area -->
            <div class="lg:col-span-3">
              <div class="space-y-8">
                <!-- Page Title -->
                <div class="text-center">
                  <h1 class="text-4xl font-bold text-webropol-gray-900 mb-4">Translation</h1>
                  <div class="inline-flex items-center px-3 py-1 bg-webropol-teal-100 text-webropol-teal-800 rounded-full text-sm font-medium">
                    <i class="fal fa-file-alt mr-2"></i>
                    PAGE 1
                  </div>
                </div>
                
                <!-- Question Container -->
                <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-xl border border-webropol-gray-100/80 overflow-hidden hover-lift">
                  <!-- Question Header -->
                  <div class="bg-gradient-to-r from-webropol-teal-600 to-webropol-teal-700 text-white p-4 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                      <span class="bg-white/20 px-2 py-1 rounded text-sm font-medium">Autosuggest text field</span>
                    </div>
                    <div class="flex items-center space-x-2">
                      <button class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="AI Suggest">
                        <i class="fal fa-magic text-white"></i>
                      </button>
                      <button class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Translations">
                        <i class="fal fa-language text-white"></i>
                      </button>
                      <button class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Upload Image">
                        <i class="fal fa-image text-white"></i>
                      </button>
                      <button class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Settings" onclick="openQuestionSettingsModal()">
                        <i class="fal fa-cog text-white"></i>
                      </button>
                      <button class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Copy">
                        <i class="fal fa-copy text-white"></i>
                      </button>
                      <button class="p-2 rounded-lg hover:bg-white/20 transition-colors" title="Delete">
                        <i class="fal fa-trash text-white"></i>
                      </button>
                    </div>
                  </div>
                  
                  <!-- Question Content -->
                  <div class="p-6">
                    <div class="mb-6">
                      <label class="block text-lg font-semibold text-webropol-gray-900 mb-2">
                        1. Auto Suggest
                      </label>
                      
                      <!-- Option Input -->
                      <div class="mb-4">
                        <label class="block text-sm font-medium text-webropol-gray-700 mb-2">Option</label>
                        <div class="relative">
                          <input 
                            type="text" 
                            class="w-full px-4 py-3 border border-webropol-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-webropol-teal-500/20 focus:border-webropol-teal-500 transition-all"
                            placeholder="Enter option text"
                          >
                          <button class="absolute right-3 top-1/2 transform -translate-y-1/2 w-8 h-8 bg-gradient-to-br from-webropol-teal-500 to-webropol-teal-600 text-white rounded-lg flex items-center justify-center hover:shadow-medium transition-all">
                            <i class="fal fa-plus text-sm"></i>
                          </button>
                        </div>
                      </div>
                      
                      <!-- Add Option Buttons -->
                      <div class="flex flex-col gap-3 mb-6">
                        <button class="btn btn-secondary w-fit">
                          <i class="fal fa-plus text-sm"></i>
                          <span>Add one option</span>
                        </button>
                        <button class="btn btn-secondary w-fit">
                          <i class="fal fa-plus text-sm"></i>
                          <span>Add or edit multiple options</span>
                        </button>
                        <button class="btn btn-secondary w-fit" onclick="openUploadModal()">
                          <i class="fal fa-upload text-sm"></i>
                          <span>Import Auto Suggestions File</span>
                        </button>
                      </div>
                      
                      <!-- Additional Actions -->
                      <div class="flex items-center justify-between pt-4 border-t border-webropol-gray-200">
                        <div class="flex space-x-4">
                          <button class="px-4 py-2 bg-webropol-teal-500 hover:bg-webropol-teal-600 text-white rounded-lg font-medium transition-colors flex items-center space-x-2 hover-lift">
                            <i class="fal fa-play"></i>
                            <span>Add question</span>
                          </button>
                          <button class="px-4 py-2 bg-webropol-gray-100 hover:bg-webropol-gray-200 text-webropol-gray-700 rounded-lg font-medium transition-colors flex items-center space-x-2">
                            <i class="fal fa-text"></i>
                            <span>Add free text/media</span>
                          </button>
                          <button class="px-4 py-2 bg-webropol-gray-100 hover:bg-webropol-gray-200 text-webropol-gray-700 rounded-lg font-medium transition-colors flex items-center space-x-2">
                            <i class="fal fa-cut"></i>
                            <span>Add page break</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Submit Button -->
                <div class="text-center">
                  <button class="px-8 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-semibold hover:shadow-medium transition-all flex items-center space-x-2 mx-auto hover-lift">
                    <span>Submit</span>
                  </button>
                  <p class="text-sm text-webropol-gray-500 mt-3">Add optional text here</p>
                </div>
                
                <!-- Thank You Page Preview -->
                <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-xl border border-webropol-gray-100/80 p-8 text-center hover-lift">
                  <div class="mb-4">
                    <div class="inline-flex items-center px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium mb-4">
                      <i class="fal fa-heart mr-2"></i>
                      Thank you page
                    </div>
                    <button class="absolute top-4 right-4 p-2 text-webropol-gray-400 hover:text-webropol-gray-600 rounded-lg hover:bg-webropol-gray-50 transition-colors">
                      <i class="fal fa-cog"></i>
                    </button>
                  </div>
                  
                  <h2 class="text-2xl font-bold text-webropol-gray-900 mb-4">Thank you for your participation!</h2>
                  
                  <!-- Webropol Logo -->
                  <div class="flex justify-center mb-6">
                    <div class="w-24 h-12 bg-gradient-to-r from-webropol-teal-500 to-webropol-teal-600 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">W</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Floating Create Button Component -->
  <webropol-floating-button></webropol-floating-button>

  <!-- Upload Auto-Suggest Modal -->
  <div id="uploadModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 700px;">
      <div class="modal-header">
        <div class="modal-title-section">
          <h2 class="modal-title">
            <div class="w-10 h-10 bg-gradient-to-br from-orange-100 to-orange-100 rounded-full flex items-center justify-center">
              <i class="fal fa-upload text-orange-600 text-lg"></i>
            </div>
            Upload Auto-Suggest
          </h2>
          <p class="modal-subtitle">Upload answer options for auto-suggest list</p>
        </div>
        <button class="modal-close" onclick="closeUploadModal()" aria-label="Close modal">
          <i class="fal fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3 class="section-title">
            <i class="fal fa-download"></i>
            Download template
          </h3>
          <p style="margin-bottom: 1rem; color: var(--webropol-gray-600);">
            Start with our template to ensure proper formatting
          </p>
          <button class="btn btn-secondary" onclick="downloadTemplate()">
            <i class="fal fa-download"></i>
            Get template file
          </button>
        </div>
        <hr style="border: none; height: 1px; background: #e2e8f0; margin: 1.5rem 0;">
        <div class="settings-section">
          <h3 class="section-title">
            <i class="fal fa-upload"></i>
            Upload template
          </h3>
          <p style="margin-bottom: 1rem; color: var(--webropol-gray-600);">
            Note: must be in CSV format, comma delimited
          </p>
          <div class="file-upload-section">
            <div class="file-upload-icon">
              <i class="fal fa-cloud-upload"></i>
            </div>
            <p style="margin-bottom: 1rem;">
              <strong>Choose File</strong>
              or drag and drop your CSV file here
            </p>
            <input
              type="file"
              id="csvFile"
              accept=".csv"
              style="display: none;"
            >
            <div style="display: flex; gap: 0.5rem; align-items: center; justify-content: center;">
              <button id="chooseFileBtn" class="px-4 py-2 bg-webropol-gray-100 hover:bg-webropol-gray-200 text-webropol-gray-700 rounded-lg font-medium transition-colors flex items-center space-x-2" onclick="document.getElementById('csvFile').click()">
                <i class="fal fa-folder-open"></i>
                <span>Choose File</span>
              </button>
              <button id="uploadBtn" class="px-4 py-2 bg-gradient-to-r from-webropol-teal-500 to-webropol-teal-600 text-white rounded-lg font-medium transition-all flex items-center space-x-2" onclick="performUpload()" disabled>
                <i class="fal fa-cloud-upload"></i>
                <span>Upload</span>
              </button>
            </div>
            <div id="fileName" style="margin-top: 1rem; font-weight: 600; color: #06b6d4;"></div>
            <button id="removeFileBtn" class="hidden mt-3 p-2 bg-webropol-gray-50 hover:bg-red-50 text-webropol-gray-500 hover:text-red-600 rounded-full transition-all" onclick="removeSelectedFile()">
              <i class="fal fa-trash"></i>
            </button>
          </div>
        </div>
        <div class="settings-section">
          <button id="removeStoredBtn" class="px-4 py-2 bg-webropol-gray-100 hover:bg-webropol-gray-200 text-webropol-gray-700 rounded-lg font-medium transition-colors flex items-center space-x-2" onclick="removeAutoSuggest()" disabled>
            <i class="fal fa-trash"></i>
            <span>Remove uploaded auto-suggest list</span>
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <div class="footer-actions">
          <button class="btn btn-secondary" onclick="closeUploadModal()">Cancel</button>
          <button id="applyBtn" class="btn btn-primary" onclick="applyAndClose()" disabled>
            Apply
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Question Settings Modal -->
  <div id="questionSettingsModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title-section">
          <h2 class="modal-title">
            <div class="w-10 h-10 bg-gradient-to-br from-orange-100 to-orange-100 rounded-full flex items-center justify-center">
              <i class="fal fa-cog text-orange-600 text-lg"></i>
            </div>
            Question settings
          </h2>
        </div>
        <button class="modal-close" onclick="closeQuestionSettingsModal()" aria-label="Close modal">
          <i class="fal fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- Option Orientation Section -->
        <div class="settings-section">
          <h3 class="section-title">
            Option orientation
          </h3>
          <div class="form-group">
            <div class="radio-group orientation-row" style="flex-direction: row;">
              <label class="radio-item active">
                <input
                  type="radio"
                  name="orientation"
                  value="vertical"
                  class="radio-input"
                  checked
                >
                <div class="radio-content">
                  <div class="radio-title">Vertical</div>
                </div>
              </label>
              <label class="radio-item">
                <input
                  type="radio"
                  name="orientation"
                  value="horizontal"
                  class="radio-input"
                >
                <div class="radio-content">
                  <div class="radio-title">Horizontal</div>
                </div>
              </label>
            </div>
          </div>
        </div>
        <hr style="border: none; height: 1px; background: #e2e8f0; margin: 1.5rem 0;">
        <!-- Column Configuration Section -->
        <div class="settings-section">
          <h3 class="section-title">
            Number of options per column
          </h3>
          <div class="form-group">
            <div class="radio-group">
              <label class="radio-item active">
                <input
                  type="radio"
                  name="columns"
                  value="all"
                  class="radio-input"
                  checked
                >
                <div class="radio-content">
                  <div class="radio-title">All options in same column</div>
                </div>
              </label>
              <label class="radio-item has-input">
                <input
                  type="radio"
                  name="columns"
                  value="custom"
                  class="radio-input"
                >
                <div class="radio-content">
                  <div class="radio-title">Custom options per column</div>
                </div>
                <div class="input-row custom-input-row">
                  <input
                    type="number"
                    class="form-input"
                    value="1"
                    min="1"
                    max="10"
                    style="width: 60px; margin-top: -6px; margin-right: 4px;"
                  >
                  <span class="form-helper" style="margin-top: -8px;">options per column</span>
                </div>
              </label>
            </div>
          </div>
        </div>
        <hr style="border: none; height: 1px; background: #e2e8f0; margin: 1.5rem 0;">
        <div style="display: flex; gap: 2rem;">
          <!-- Option Placement Section -->
          <div class="settings-section" style="flex: 1; margin-bottom: 0;">
            <h3 class="section-title">
              Option placement title
            </h3>
            <div class="form-group">
              <label class="form-label">Title position</label>
              <select class="form-select">
                <option value="left">Left</option>
                <option value="right">Right</option>
                <option value="center">Center</option>
                <option value="top">Top</option>
                <option value="bottom">Bottom</option>
              </select>
            </div>
          </div>
          <!-- Text Field Configuration -->
          <div class="settings-section" style="flex: 1; margin-bottom: 0;">
            <h3 class="section-title">
              Text field size
            </h3>
            <div class="form-group">
              <label class="form-label">Width</label>
              <div class="input-row">
                <input
                  type="number"
                  class="form-input"
                  value="40"
                  min="1"
                  max="150"
                  style="width: 100px;"
                >
                <span class="form-helper">characters (range 1-150)</span>
              </div>
            </div>
          </div>
        </div>
        <hr style="border: none; height: 1px; background: #e2e8f0; margin: 1.5rem 0;">
        <!-- Question Description Section -->
        <div class="settings-section">
          <h3 class="section-title">
            Question description
            <span class="info-tooltip" data-tooltip="Additional information to help users understand the question">
              <i class="fal fa-question-circle"></i>
            </span>
          </h3>
          <div class="form-group">
            <div class="checkbox-item">
              <input type="checkbox" id="showDescription" class="checkbox-input">
              <div class="checkbox-content">
                <label for="showDescription" class="checkbox-title">Show question description</label>
                <div class="placement-options" id="placementOptions" style="display: none;">
                  <label class="form-label">Placement</label>
                  <div class="placement-radio">
                    <label class="radio-item">
                      <input
                        type="radio"
                        name="description-placement"
                        value="below"
                        class="radio-input"
                        checked
                      >
                      <span>Show below question title</span>
                    </label>
                    <label class="radio-item">
                      <input
                        type="radio"
                        name="description-placement"
                        value="above"
                        class="radio-input"
                      >
                      <span>Show above question title</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <hr style="border: none; height: 1px; background: #e2e8f0; margin: 1.5rem 0;">
        <!-- Auto-Suggest Section -->
        <div class="settings-section">
          <h3 class="section-title">
            Auto-suggest File
            <span class="info-tooltip" data-tooltip="When uploading an AutoSuggest file with more than 1,000 options, it will be placed into a processing queue. While processing you won't be able to send out your survey. Once complete, you'll receive an email notification.">
              <i class="fal fa-question-circle"></i>
            </span>
          </h3>
          <div class="file-upload-section-button">
            <div class="file-actions">
              <button class="btn btn-primary" onclick="openUploadModal()">
                Upload file
              </button>
              <div id="mainUploadStatus" class="upload-status">
                No file uploaded
              </div>
            </div>
            <p class="form-helper" style="margin-top: 1rem;">
              Note: File must be in CSV format, comma delimited. Maximum file size: 10MB
            </p>
          </div>
        </div>
        <hr style="border: none; height: 1px; background: #e2e8f0; margin: 1.5rem 0;">
        <!-- Visibility Section -->
        <div class="settings-section visibility-row">
          <h3 class="section-title">
            Visibility
          </h3>
          <div class="visibility-options ml-8">
            <label class="visibility-item visibility-visible">
              <input
                type="radio"
                name="visibility"
                value="visible"
                checked
              >
              <div class="visibility-icon">
                <i class="fal fa-eye"></i>
              </div>
              <span>Visible</span>
            </label>
            <label class="visibility-item visibility-hidden">
              <input type="radio" name="visibility" value="hidden">
              <div class="visibility-icon">
                <i class="fal fa-eye-slash"></i>
              </div>
              <span>Hidden</span>
            </label>
            <label class="visibility-item visibility-disabled">
              <input type="radio" name="visibility" value="disabled">
              <div class="visibility-icon">
                <i class="fal fa-ban"></i>
              </div>
              <span>Disabled</span>
            </label>
          </div>
        </div>
        <hr style="border: none; height: 1px; background: #e2e8f0; margin: 1.5rem 0;">
        <!-- Keywords / Save to library -->
        <div class="settings-section">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap;">
            <button class="btn btn-secondary" style="display:inline-flex; align-items:center; gap:0.5rem;">
              <i class="fal fa-save"></i>
              Save question to library
            </button>
            <div style="display:flex; align-items:center; gap:1rem;">
              <div class="keywords-label">
                <i class="fal fa-tags"></i>
                Keywords
                <span class="keywords-count">0</span>
                <span class="info-tooltip" data-tooltip="Add keywords to help categorize and find this question later">
                  <i class="fal fa-question-circle"></i>
                </span>
              </div>
              <div class="keywords-input" aria-hidden="true">
                <div class="keywords-chips"></div>
                <input type="text" placeholder="Add a keyword">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="footer-actions">
          <button class="btn btn-secondary" onclick="closeQuestionSettingsModal()">Cancel</button>
          <button class="btn btn-primary">
            Apply
          </button>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      padding: 1rem;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* Ensure Upload modal can appear above Question Settings modal */
    #uploadModal {
      z-index: 1000;
    }

    #uploadModal.above-settings {
      z-index: 1001;
    }

    /* Button Styles from auto-suggest.html */
    .btn {
      padding: 0.625rem 1.5rem;
      border: none;
      border-radius: 9999px !important;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }

    .btn.w-full {
      width: 100%;
      justify-content: center;
    }

    .btn-primary {
      background: #0891b2;
      color: white;
    }

    .btn-primary:hover {
      background: #0e7490;
      transform: translateY(-1px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .btn-secondary {
      background: white;
      color: #374151;
      border: 1px solid #0891b2;
    }

    .btn-secondary:hover {
      background: #ccf7fe;
      border-color: #94a3b8;
    }

    .btn:disabled,
    .btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .btn-primary:disabled,
    .btn-primary[disabled] {
      background: #d1d5db;
      color: #6b7280;
    }

    .btn-secondary:disabled,
    .btn-secondary[disabled] {
      background: #f3f4f6;
      color: #9ca3af;
      border-color: #d1d5db;
    }

    .delete-btn:hover i {
      color: #dc2626 !important;
    }

    .btn i {
      font-size: 1.125rem;
    }

    .btn i.fal {
      color: #0891b2;
    }

    .modal-content {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      width: 100%;
      max-width: 800px;
      max-height: 90vh;
      overflow: hidden;
      transform: scale(0.9) translateY(20px);
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
    }

    .modal-overlay.active .modal-content {
      transform: scale(1) translateY(0);
    }

    .modal-header {
      padding: 1.25rem 1.5rem;
      background: #ffffff;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .modal-title-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 0.25rem;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #334155;
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .modal-subtitle {
      font-size: 0.875rem;
      color: #64748b;
      margin-left: calc(2.5rem + 0.75rem);
    }

    .modal-close {
      width: 2.5rem;
      height: 2.5rem;
      border: none;
      background: #f1f5f9;
      border-radius: 0.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #64748b;
      transition: all 0.15s ease;
    }

    .modal-close:hover {
      background: #e2e8f0;
      color: #334155;
    }

    .modal-body {
      padding: 1.5rem;
      overflow-y: auto;
      flex: 1;
    }

    .settings-section {
      margin-bottom: 2rem;
    }

    .settings-section:last-child {
      margin-bottom: 0;
    }

    .section-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .file-upload-section {
      background: #f8fafc;
      border: 2px dashed #cbd5e1;
      border-radius: 0.5rem;
      padding: 1.5rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .file-upload-icon {
      width: 3rem;
      height: 3rem;
      background: #ccf7fe;
      color: #06b6d4;
      border-radius: 0.5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      font-size: 1.25rem;
    }

    .modal-footer {
      padding: 1.5rem;
      background: #ffffff;
      border-top: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .footer-actions {
      display: flex;
      gap: 0.75rem;
      margin-left: auto;
    }

    .btn {
      padding: 0.625rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .btn-secondary {
      background: #f1f5f9;
      color: #334155;
      border: 1px solid #e2e8f0;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #e2e8f0;
      border-color: #cbd5e1;
    }

    .btn-primary {
      background: linear-gradient(to right, #0891b2, #0e7490);
      color: white;
      border: none;
    }

    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(to right, #0e7490, #164e63);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3);
    }

    /* Utility classes */
    .w-10 { width: 2.5rem; }
    .h-10 { height: 2.5rem; }
    .bg-gradient-to-br { background: linear-gradient(to bottom right, #fed7aa, #fed7aa); }
    .from-orange-100 { --tw-gradient-from: #fed7aa; }
    .to-orange-100 { --tw-gradient-to: #fed7aa; }
    .rounded-full { border-radius: 9999px; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .text-orange-600 { color: #ea580c; }
    .text-lg { font-size: 1.125rem; }
    .hidden { display: none !important; }
    .mt-3 { margin-top: 0.75rem; }

    /* Question Settings Modal Additional Styles */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .radio-group.orientation-row {
      gap: 1.75rem;
    }

    .radio-item.has-input .radio-content {
      flex: 0 1 auto;
      margin-right: 0.5rem;
    }

    .radio-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
    }

    .radio-group .radio-item.has-input {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .radio-input {
      width: 1.25rem;
      height: 1.25rem;
      accent-color: #0891b2;
    }

    .radio-content {
      flex: 1;
    }

    .radio-title {
      font-weight: 500;
      color: #1f2937;
      margin-bottom: 0.25rem;
    }

    .input-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .custom-input-row {
      margin-top: 0.4rem;
      gap: 0.4rem;
    }

    .form-input {
      padding: 0.75rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      transition: all 0.15s ease;
      background: white;
    }

    .form-input:focus {
      outline: none;
      border-color: #0891b2;
      box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.1);
    }

    .form-select {
      padding: 0.75rem 1rem;
      padding-right: 2.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      background: white;
      cursor: pointer;
      min-width: 150px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 512'%3E%3Cpath fill='%23333' d='M31 192h258c28.4 0 42.8 34.5 22.6 54.6l-129 129c-12.5 12.5-32.8 12.5-45.3 0l-129-129C-11.8 226.5 4.6 192 31 192z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 12px 12px;
    }

    .form-select:focus {
      outline: none;
      border-color: #0891b2;
      box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.1);
    }

    .form-helper {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }

    .checkbox-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      transition: all 0.15s ease;
    }

    .checkbox-input {
      width: 1.25rem;
      height: 1.25rem;
      accent-color: #0891b2;
      margin-top: 0.125rem;
    }

    .checkbox-content {
      flex: 1;
    }

    .checkbox-title {
      font-weight: 500;
      color: #1f2937;
      margin-bottom: 0.5rem;
    }

    .placement-options {
      margin-left: 1.75rem;
      margin-top: 0.75rem;
    }

    .placement-radio {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .placement-radio .radio-item {
      margin: 0;
    }

    .file-upload-section-button {
      text-align: center;
      margin-bottom: 1rem;
    }

    .file-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      align-items: center;
      width: 100%;
      margin-top: 1rem;
    }

    .file-actions > * {
      display: inline-flex;
      align-items: center;
    }

    .upload-status {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: #ffffff;
      color: #111827;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
      margin: 0;
    }

    .visibility-section {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem;
    }

    .settings-section.visibility-row {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .settings-section.visibility-row .section-title {
      margin-bottom: 0;
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      white-space: nowrap;
    }

    .settings-section.visibility-row .visibility-options {
      display: flex;
      gap: 1.25rem;
      align-items: center;
      justify-content: flex-start;
      flex: 1 1 auto;
    }

    .visibility-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .visibility-icon {
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.375rem;
      font-size: 0.875rem;
    }

    .visibility-visible .visibility-icon {
      background: #dcfce7;
      color: #16a34a;
    }

    .visibility-hidden .visibility-icon {
      background: #fef3c7;
      color: #d97706;
    }

    .visibility-disabled .visibility-icon {
      background: #e5e7eb;
      color: #6b7280;
    }

    .keywords-section {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .keywords-label {
      font-size: 0.875rem;
      color: #4b5563;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .keywords-count {
      background: #e5e7eb;
      color: #374151;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .keywords-input {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: #ffffff;
      padding: 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #e5e7eb;
    }

    .keywords-input input[type="text"] {
      border: none;
      outline: none;
      font-size: 0.875rem;
      padding: 0.25rem 0.5rem;
      background: transparent;
      min-width: 160px;
    }

    .keywords-chips {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .keyword-chip {
      background: #f3f4f6;
      color: #1f2937;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
    }

    .info-tooltip {
      position: relative;
      cursor: help;
    }

    .info-tooltip i {
      color: #1e293b;
      margin-left: 0.5rem;
      font-size: 1.125rem;
      line-height: 1;
      vertical-align: middle;
    }

    .ml-1 { margin-left: 0.25rem; }
    .ml-2 { margin-left: 0.5rem; }
    .ml-3 { margin-left: 0.75rem; }
    .ml-4 { margin-left: 1rem; }
    .ml-8 { margin-left: 2rem; }

    @media (max-width: 768px) {
      .modal-content {
        margin: 1rem;
        max-height: calc(100vh - 2rem);
      }

      .modal-subtitle {
        margin-left: 0;
      }

      .footer-actions {
        flex-direction: column;
        width: 100%;
      }

      .btn {
        justify-content: center;
      }
    }
  </style>

  <script>
    function surveyEditApp() {
      return {
        // Survey editor specific logic here
        autoSave: true,
        
        init() {
          console.log('Survey Editor initialized');
          
          // Auto-save functionality
          if (this.autoSave) {
            setInterval(() => {
              this.performAutoSave();
            }, 30000); // Auto-save every 30 seconds
          }
        },
        
        performAutoSave() {
          console.log('Auto-saving survey...');
          // Implementation for auto-saving
        },
        
        addQuestion(type) {
          console.log('Adding question of type:', type);
          // Implementation for adding questions
        },
        
        deleteQuestion(id) {
          console.log('Deleting question:', id);
          // Implementation for deleting questions
        },
        
        previewSurvey() {
          console.log('Previewing survey...');
          // Implementation for previewing survey
        },
        
        saveSurvey() {
          console.log('Saving survey...');
          // Implementation for saving survey
        }
      }
    }

    // Modal functionality
    function openUploadModal() {
      const modal = document.getElementById('uploadModal');
      const questionSettingsModal = document.getElementById('questionSettingsModal');
      
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      // If Question Settings modal is open, make Upload modal appear above it
      if (questionSettingsModal && questionSettingsModal.classList.contains('active')) {
        modal.classList.add('above-settings');
      } else {
        modal.classList.remove('above-settings');
      }
    }

    function closeUploadModal() {
      const modal = document.getElementById('uploadModal');
      const questionSettingsModal = document.getElementById('questionSettingsModal');
      
      modal.classList.remove('active');
      modal.classList.remove('above-settings'); // Reset z-index class
      
      // Only restore body overflow if Question Settings modal is not open
      if (!questionSettingsModal || !questionSettingsModal.classList.contains('active')) {
        document.body.style.overflow = '';
      }
      
      // Reset modal state
      resetModalState();
    }

    function resetModalState() {
      document.getElementById('csvFile').value = '';
      document.getElementById('fileName').textContent = '';
      document.getElementById('uploadBtn').disabled = true;
      document.getElementById('applyBtn').disabled = true;
      document.getElementById('removeFileBtn').classList.add('hidden');
    }

    function downloadTemplate() {
      const csvContent = 'Answer Option\n"Option 1"\n"Option 2"\n"Option 3"';
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'auto-suggest-template.csv';
      a.click();
      window.URL.revokeObjectURL(url);
    }

    function performUpload() {
      const fileInput = document.getElementById('csvFile');
      const file = fileInput.files[0];
      
      if (!file) {
        alert('Please select a CSV file');
        return;
      }

      if (!file.name.toLowerCase().endsWith('.csv')) {
        alert('Please select a valid CSV file');
        return;
      }

      // Simulate upload process
      const uploadBtn = document.getElementById('uploadBtn');
      const originalText = uploadBtn.innerHTML;
      uploadBtn.innerHTML = '<i class="fal fa-spinner fa-spin"></i> <span>Uploading...</span>';
      uploadBtn.disabled = true;

      setTimeout(() => {
        uploadBtn.innerHTML = '<i class="fal fa-check"></i> <span>Uploaded</span>';
        document.getElementById('applyBtn').disabled = false;
        document.getElementById('removeStoredBtn').disabled = false;
        
        setTimeout(() => {
          uploadBtn.innerHTML = originalText;
          uploadBtn.disabled = false;
        }, 2000);
      }, 1500);
    }

    function removeSelectedFile() {
      document.getElementById('csvFile').value = '';
      document.getElementById('fileName').textContent = '';
      document.getElementById('uploadBtn').disabled = true;
      document.getElementById('removeFileBtn').classList.add('hidden');
    }

    function removeAutoSuggest() {
      if (confirm('Are you sure you want to remove the uploaded auto-suggest list?')) {
        document.getElementById('removeStoredBtn').disabled = true;
        document.getElementById('applyBtn').disabled = true;
        // Add any cleanup logic here
      }
    }

    function applyAndClose() {
      // Add logic to apply the uploaded suggestions
      const questionSettingsModal = document.getElementById('questionSettingsModal');
      
      closeUploadModal();
      
      // If Question Settings modal is still open, ensure it stays visible
      if (questionSettingsModal && questionSettingsModal.classList.contains('active')) {
        document.body.style.overflow = 'hidden';
      }
    }

    // Question Settings Modal functionality
    function openQuestionSettingsModal() {
      const modal = document.getElementById('questionSettingsModal');
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeQuestionSettingsModal() {
      const modal = document.getElementById('questionSettingsModal');
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }

    // File input change handler and modal event listeners
    document.addEventListener('DOMContentLoaded', function() {
      const fileInput = document.getElementById('csvFile');
      if (fileInput) {
        fileInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('uploadBtn').disabled = false;
            document.getElementById('removeFileBtn').classList.remove('hidden');
          }
        });
      }

      // Close modal when clicking outside
      const uploadModal = document.getElementById('uploadModal');
      if (uploadModal) {
        uploadModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeUploadModal();
          }
        });
      }

      // Question Settings Modal event listeners
      const questionSettingsModal = document.getElementById('questionSettingsModal');
      if (questionSettingsModal) {
        questionSettingsModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeQuestionSettingsModal();
          }
        });
      }

      // Radio button interactions for question settings
      document.querySelectorAll('#questionSettingsModal .radio-item').forEach(item => {
        item.addEventListener('click', function() {
          const radio = this.querySelector('input[type="radio"]');
          if (radio) {
            // Remove active class from siblings
            const siblings = this.closest('.radio-group').querySelectorAll('.radio-item');
            siblings.forEach(sibling => sibling.classList.remove('active'));

            // Add active class to clicked item
            this.classList.add('active');
            radio.checked = true;
          }
        });
      });

      // Checkbox interaction for question description
      const showDescriptionCheckbox = document.getElementById('showDescription');
      if (showDescriptionCheckbox) {
        showDescriptionCheckbox.addEventListener('change', function() {
          const placementOptions = document.getElementById('placementOptions');
          if (placementOptions) {
            placementOptions.style.display = this.checked ? 'block' : 'none';
          }
        });
      }

      // Keywords functionality (simplified version)
      const keywordsInput = document.querySelector('#questionSettingsModal .keywords-input input[type="text"]');
      const keywordsChips = document.querySelector('#questionSettingsModal .keywords-chips');
      const keywordsCount = document.querySelector('#questionSettingsModal .keywords-count');
      let keywords = [];

      function updateKeywordsCount() {
        if (keywordsCount) keywordsCount.textContent = keywords.length;
      }

      function renderKeywordsChips() {
        if (!keywordsChips) return;
        keywordsChips.innerHTML = '';
        keywords.forEach(keyword => {
          const chip = document.createElement('span');
          chip.className = 'keyword-chip';
          chip.textContent = keyword;
          
          const removeBtn = document.createElement('button');
          removeBtn.type = 'button';
          removeBtn.style.marginLeft = '0.4rem';
          removeBtn.style.background = 'transparent';
          removeBtn.style.border = 'none';
          removeBtn.style.cursor = 'pointer';
          removeBtn.innerHTML = '<i class="fal fa-times"></i>';
          removeBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            keywords = keywords.filter(k => k !== keyword);
            renderKeywordsChips();
            updateKeywordsCount();
          });
          
          chip.appendChild(removeBtn);
          keywordsChips.appendChild(chip);
        });
        updateKeywordsCount();
      }

      if (keywordsInput) {
        keywordsInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ',') {
            e.preventDefault();
            const value = this.value.trim();
            if (value && !keywords.includes(value) && keywords.length < 20) {
              keywords.push(value);
              renderKeywordsChips();
              this.value = '';
            }
          }
        });
      }

      // Floating tooltips functionality
      (function () {
        let tipEl = null;

        function showTip(target) {
          const text = target.getAttribute('data-tooltip');
          if (!text) return;
          if (!tipEl) {
            tipEl = document.createElement('div');
            tipEl.className = 'floating-tooltip';
            tipEl.style.cssText = `
              position: fixed;
              background: #1f2937;
              color: white;
              padding: 0.75rem;
              border-radius: 0.375rem;
              font-size: 0.75rem;
              line-height: 1.3;
              max-width: 320px;
              box-shadow: 0 8px 26px rgba(0, 0, 0, 0.18);
              z-index: 99999;
              word-wrap: break-word;
              text-align: left;
              pointer-events: none;
              opacity: 0;
              transition: opacity 150ms ease;
            `;
            document.body.appendChild(tipEl);
          }
          tipEl.innerText = text;
          tipEl.style.opacity = '1';

          // Positioning
          const rect = target.getBoundingClientRect();
          const tipRect = tipEl.getBoundingClientRect();
          const spaceAbove = rect.top;
          const spaceBelow = window.innerHeight - rect.bottom;

          // Prefer above, but flip if not enough space
          let top = rect.top - tipRect.height - 10; // 10px offset
          let left = rect.left + (rect.width / 2) - (tipRect.width / 2);
          if (spaceAbove < tipRect.height + 12 && spaceBelow > spaceAbove) {
            top = rect.bottom + 10;
          }

          // Keep within viewport
          left = Math.max(8, Math.min(left, window.innerWidth - tipRect.width - 8));
          top = Math.max(8, Math.min(top, window.innerHeight - tipRect.height - 8));

          tipEl.style.left = left + 'px';
          tipEl.style.top = top + 'px';
        }

        function hideTip() {
          if (tipEl) {
            tipEl.style.opacity = '0';
          }
        }

        document.querySelectorAll('.info-tooltip').forEach(el => {
          el.addEventListener('mouseenter', () => showTip(el));
          el.addEventListener('focus', () => showTip(el));
          el.addEventListener('mouseleave', hideTip);
          el.addEventListener('blur', hideTip);
        });

        // Reposition on resize/scroll
        window.addEventListener('resize', () => { 
          if (tipEl && tipEl.style.opacity === '1') tipEl.style.opacity = '0'; 
        });
        window.addEventListener('scroll', () => { 
          if (tipEl && tipEl.style.opacity === '1') tipEl.style.opacity = '0'; 
        }, true);
      })();
    });
  </script>
</body>
</html>
