<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Email Campaign Management - Private Distribution | Webropol Enterprise</title>
	<!-- Standard Tailwind + FontAwesome + Alpine.js stack -->
	<script src="https://cdn.tailwindcss.com"></script>
	<script src="https://kit.fontawesome.com/50ef2d3cf8.js" crossorigin="anonymous"></script>
	<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

	<!-- Webropol design tokens and components -->
	<link href="../../design-system/styles/tokens.css" rel="stylesheet" />
	<link href="../../design-system/styles/mobile-responsive.css" rel="stylesheet" />
	<script src="../../design-system/components/navigation/Sidebar.js" type="module"></script>
	<script src="../../design-system/components/navigation/Header.js" type="module"></script>
	<script src="../../design-system/components/cards/Card.js" type="module"></script>
	<script src="../../design-system/components/buttons/Button.js" type="module"></script>
	<script src="../../design-system/components/feedback/Badge.js" type="module"></script>
	<script src="../../design-system/components/modals/Modal.js" type="module"></script>

	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						'webropol-primary': {
							50: '#f0fdff', 100: '#ccf7fe', 200: '#99effd', 300: '#66e0fa', 400: '#22ccf1', 500: '#06b6d4', 600: '#0891b2', 700: '#0e7490', 800: '#155e75', 900: '#164e63'
						},
						'webropol-gray': {
							50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a'
						}
					},
					fontFamily: { 'sans': ['Inter','system-ui','sans-serif'] }
				}
			}
		}
	</script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

	<style>
		[x-cloak] { display: none !important; }
		.wysiwyg-toolbar button { color: #334155; transition: all 0.2s ease; }
		.wysiwyg-toolbar button:hover { background-color: #f1f5f9; }
		.wysiwyg-toolbar button[aria-pressed="true"] { color: #0e7490; background-color: #e6fffa; }
		
		/* Corporate-grade table styles */
		.enterprise-table { 
			border-collapse: separate; 
			border-spacing: 0;
		}
		.enterprise-table th {
			background: linear-gradient(180deg, #fafbfc 0%, #f4f6f8 100%);
			font-weight: 600;
			text-transform: uppercase;
			font-size: 0.75rem;
			letter-spacing: 0.05em;
			color: #475569;
			border-bottom: 2px solid #e2e8f0;
		}
		.enterprise-table tbody tr {
			transition: all 0.15s ease;
			border-bottom: 1px solid #f1f5f9;
		}
		.enterprise-table tbody tr:hover {
			background-color: #f8fafc;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
		}
		
		/* Status indicators */
		.status-indicator {
			display: inline-flex;
			align-items: center;
			gap: 0.375rem;
			padding: 0.25rem 0.75rem;
			border-radius: 9999px;
			font-size: 0.75rem;
			font-weight: 500;
		}
		.status-success { background-color: #dcfce7; color: #166534; }
		.status-warning { background-color: #fef3c7; color: #92400e; }
		.status-error { background-color: #fecaca; color: #991b1b; }
		.status-info { background-color: #dbeafe; color: #1e40af; }
		
		/* Enhanced form controls */
		.enterprise-input {
			transition: all 0.2s ease;
			border: 1.5px solid #e2e8f0;
		}
		.enterprise-input:focus {
			border-color: #0891b2;
			box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.1);
			outline: none;
		}
		.enterprise-input:invalid {
			border-color: #ef4444;
			box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
		}
		
		/* Action panels */
		.action-panel {
			background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
			border: 1px solid #e2e8f0;
			box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
		}
		
		/* Mobile responsive enhancements */
		.mobile-show-cards { display: none; } /* Hide mobile cards on desktop */
		
		@media (max-width: 768px) {
			.mobile-stack > * { width: 100% !important; margin-bottom: 0.75rem; }
			.mobile-hide { display: none !important; }
			.mobile-hide-table { display: none !important; }
			.mobile-show-cards { display: block !important; }
		}
	</style>
    
    <!-- Global Analytics Tracker -->
    <script src="../scripts/analytics-global-tracker.js"></script>
</head>
<body class="" x-data="privateLinksPage()" x-init="init()">
	<div class="flex h-screen">
		<webropol-sidebar active="surveys" base="../../"></webropol-sidebar>

		<div class="flex-1 overflow-hidden flex flex-col">
			<webropol-header title="Email Campaign Management" subtitle="Private Distribution Lists"></webropol-header>

			<main class="flex-1 overflow-y-auto px-4 py-6 lg:px-8">
				<div class="max-w-7xl mx-auto space-y-6">

					<!-- Navigation Header -->
					<div class="bg-white rounded-xl border border-webropol-gray-200 px-6 py-4 shadow-sm">
						<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
							<nav class="flex items-center gap-2 text-sm" aria-label="Breadcrumb">
								<a href="../collect.html" class="inline-flex items-center text-webropol-primary-700 hover:text-webropol-primary-800 transition-colors">
									<i class="fa-regular fa-arrow-left mr-2"></i>Collection Methods
								</a>
								<i class="fa-regular fa-chevron-right text-webropol-gray-400"></i>
								<span class="text-webropol-gray-900 font-medium">Private Distribution</span>
							</nav>
							<div class="flex items-center gap-3 mobile-stack">
								<webropol-button variant="secondary" size="sm" @click="exportRecipients()">
									<i class="fa-regular fa-download mr-2"></i>Export Data
								</webropol-button>
								<webropol-button variant="secondary" size="sm" @click="showAuditLog()">
									<i class="fa-regular fa-clock-rotate-left mr-2"></i>Activity Log
								</webropol-button>
								<webropol-button variant="primary" size="sm" @click="showQuickSend()">
									<i class="fa-regular fa-paper-plane mr-2"></i>Quick Send
								</webropol-button>
							</div>
						</div>
					</div>

					<!-- Enterprise Recipients Management -->
					<section class="bg-white border border-webropol-gray-200 rounded-xl shadow-sm">
						<div class="px-6 py-4 border-b border-webropol-gray-200">
							<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
								<div class="flex items-center gap-4">
									<h2 class="text-lg font-semibold text-webropol-gray-800">Recipients Management</h2>
									<div class="flex items-center gap-2">
										<webropol-badge variant="primary" x-text="recipients.length + ' Total'"></webropol-badge>
										<webropol-badge variant="success" x-text="recipients.filter(r => r.valid).length + ' Valid'"></webropol-badge>
										<webropol-badge variant="warning" x-show="recipients.filter(r => !r.valid).length > 0" x-text="recipients.filter(r => !r.valid).length + ' Invalid'"></webropol-badge>
									</div>
								</div>
								<div class="flex items-center gap-2 mobile-stack">
									<webropol-button variant="secondary" size="sm" @click="showBulkImport()">
										<i class="fa-regular fa-upload mr-2"></i>Import CSV/Excel
									</webropol-button>
									<webropol-button variant="secondary" size="sm" @click="addRecipientSample()">
										<i class="fa-regular fa-user-plus mr-2"></i>Add Individual
									</webropol-button>
									<webropol-button variant="secondary" size="sm" @click="toggleDemographics">
										<i class="fa-regular fa-table-list mr-2"></i>Demographics
									</webropol-button>
								</div>
							</div>
						</div>

						<!-- Search and Filter Controls -->
						<div x-data="{ showAdvanced: false }" class="px-6 py-4 bg-webropol-gray-50 border-b border-webropol-gray-200">
							<!-- Simple Search Bar -->
							<div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between mb-3">
								<div class="flex-1 flex items-center gap-3">
									<div class="relative flex-1 max-w-md">
										<i class="fa-regular fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-webropol-gray-400"></i>
										<input type="text" 
											   placeholder="Search recipients by name or email..." 
											   class="w-full pl-10 pr-4 py-2 border border-webropol-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-webropol-primary-500 focus:border-webropol-primary-500" 
											   x-model="searchText" 
											   @input.debounce.300ms="performSearch()" />
									</div>
									<select class="px-3 py-2 border border-webropol-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-webropol-primary-500" x-model="statusFilter">
										<option value="">All Recipients</option>
										<option value="responded">Responded</option>
										<option value="sent">Sent</option>
										<option value="unsent">Not Sent</option>
										<option value="valid">Valid Email</option>
										<option value="invalid">Invalid Email</option>
									</select>
								</div>
								<div class="flex items-center gap-2">
									<button @click="showAdvanced = !showAdvanced" 
											class="flex items-center gap-2 px-3 py-2 text-sm text-webropol-gray-600 hover:text-webropol-gray-800 hover:bg-webropol-gray-100 rounded-lg transition-colors">
										<i class="fa-regular fa-sliders-h"></i>
										<span x-text="showAdvanced ? 'Hide Advanced' : 'Advanced Filters'"></span>
										<i class="fa-regular fa-chevron-down text-xs transition-transform" :class="showAdvanced ? 'rotate-180' : ''"></i>
									</button>
									<button @click="clearAllFilters()" 
											x-show="searchText || statusFilter"
											class="px-3 py-2 text-sm text-webropol-gray-500 hover:text-webropol-gray-700 hover:bg-webropol-gray-100 rounded-lg transition-colors">
										<i class="fa-regular fa-times mr-1"></i>Clear
									</button>
								</div>
							</div>

							<!-- Advanced Filters (Collapsible) -->
							<div x-show="showAdvanced" 
								 x-transition:enter="transition ease-out duration-200"
								 x-transition:enter-start="opacity-0 transform -translate-y-2"
								 x-transition:enter-end="opacity-100 transform translate-y-0"
								 x-transition:leave="transition ease-in duration-150"
								 x-transition:leave-start="opacity-100"
								 x-transition:leave-end="opacity-0"
								 class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-white rounded-lg border border-webropol-gray-200">
								
								<div>
									<label class="block text-sm font-medium text-webropol-gray-700 mb-2">Search Field</label>
									<select class="w-full px-3 py-2 border border-webropol-gray-300 rounded-lg text-sm" x-model="searchField">
										<option value="firstName">Name</option>
										<option value="email">Email</option>
										<option value="department">Department</option>
										<option value="role">Role</option>
									</select>
								</div>

								<div>
									<label class="block text-sm font-medium text-webropol-gray-700 mb-2">Search Type</label>
									<select class="w-full px-3 py-2 border border-webropol-gray-300 rounded-lg text-sm" x-model="searchOp">
										<option value="contains">Contains</option>
										<option value="starts">Starts with</option>
										<option value="exact">Exact match</option>
									</select>
								</div>

								<div>
									<label class="block text-sm font-medium text-webropol-gray-700 mb-2">Results Per Page</label>
									<select class="w-full px-3 py-2 border border-webropol-gray-300 rounded-lg text-sm" x-model.number="pageSize">
										<option value="10">10 per page</option>
										<option value="25">25 per page</option>
										<option value="50">50 per page</option>
										<option value="100">100 per page</option>
									</select>
								</div>
							</div>
						</div>

						<!-- Recipients Data Table -->
						<div class="overflow-hidden">
							<!-- Bulk Actions Bar -->
							<div x-show="selectedCount() > 0" 
								 x-transition:enter="transition ease-out duration-200"
								 x-transition:enter-start="opacity-0 transform -translate-y-2"
								 x-transition:enter-end="opacity-100 transform translate-y-0"
								 class="px-6 py-3 bg-gradient-to-r from-webropol-primary-50 to-webropol-primary-100 border-b border-webropol-primary-200">
								<div class="flex items-center justify-between">
									<div class="flex items-center gap-3">
										<div class="flex items-center gap-2">
											<div class="w-5 h-5 bg-webropol-primary-600 rounded-full flex items-center justify-center">
												<i class="fa-solid fa-check text-white text-xs"></i>
											</div>
											<span class="text-sm font-medium text-webropol-primary-800">
												<span x-text="selectedCount()"></span> recipient(s) selected
											</span>
									</div>
									<div class="flex items-center gap-2">
										<button @click="selectAll()" class="text-sm text-webropol-primary-700 hover:text-webropol-primary-800 font-medium">
											Select All
										</button>
										<span class="text-webropol-gray-400">•</span>
										<button @click="clearSelection()" class="text-sm text-webropol-gray-600 hover:text-webropol-gray-800">
											Clear
										</button>
									</div>
								</div>
								<div class="flex items-center gap-2">
									<webropol-button variant="primary" size="sm" @click="sendToSelected()">
										<i class="fa-regular fa-paper-plane mr-1"></i>Send Campaign
									</webropol-button>
									<webropol-button variant="secondary" size="sm" @click="exportSelected()">
										<i class="fa-regular fa-download mr-1"></i>Export
									</webropol-button>
									<webropol-button variant="destructive" size="sm" @click="removeSelected()">
										<i class="fa-regular fa-trash mr-1"></i>Remove
									</webropol-button>
								</div>
							</div>
						</div>							<!-- Desktop Table View -->
							<div class="overflow-x-auto mobile-hide-table">
								<table class="min-w-full text-sm">
									<thead class="bg-webropol-gray-50 border-b border-webropol-gray-200">
										<tr>
											<th class="px-4 py-4 w-10">
												<input type="checkbox" 
													   class="rounded border-2 text-webropol-primary-600" 
													   aria-label="Select all recipients" 
													   x-model="selectAll" 
													   @change="toggleSelectAll" />
											</th>
											<th class="px-4 py-4 text-left font-medium text-webropol-gray-700">
												<div class="group cursor-pointer flex items-center gap-2" @click="sortBy('email')">
													<span>Contact Information</span>
													<i class="fa-regular fa-sort text-webropol-gray-400 group-hover:text-webropol-primary-600 transition-colors" 
													   :class="sortField === 'email' ? (sortDirection === 'asc' ? 'fa-sort-up text-webropol-primary-600' : 'fa-sort-down text-webropol-primary-600') : 'fa-sort'"></i>
												</div>
											</th>
											<th class="px-4 py-4 text-left font-medium text-webropol-gray-700">Organization</th>
											<th class="px-4 py-4 text-center font-medium text-webropol-gray-700">
												<div class="group cursor-pointer flex items-center justify-center gap-2" @click="sortBy('sent')">
													<span>Campaign Stats</span>
													<i class="fa-regular fa-sort text-webropol-gray-400 group-hover:text-webropol-primary-600 transition-colors" 
													   :class="sortField === 'sent' ? (sortDirection === 'asc' ? 'fa-sort-up text-webropol-primary-600' : 'fa-sort-down text-webropol-primary-600') : 'fa-sort'"></i>
												</div>
											</th>
											<th class="px-4 py-3 text-center">Status</th>
											<th class="px-4 py-3 text-center w-24">Actions</th>
										</tr>
									</thead>
									<tbody>
										<template x-for="(r, idx) in pagedRecipients()" :key="r.id">
											<tr class="group">
												<td class="px-4 py-3">
													<input type="checkbox" 
														   class="rounded border-2 text-webropol-primary-600" 
														   x-model="r.selected" />
												</td>
												<td class="px-4 py-3">
													<div class="flex items-center gap-3">
														<div class="w-8 h-8 bg-webropol-primary-100 rounded-full flex items-center justify-center">
															<span class="text-xs font-semibold text-webropol-primary-700" 
																  x-text="r.firstName.charAt(0).toUpperCase()"></span>
														</div>
														<div>
															<div class="font-medium text-webropol-gray-900" x-text="r.email"></div>
															<div class="text-xs text-webropol-gray-500" x-text="'Last updated ' + formatDate(r.lastUpdated)"></div>
														</div>
													</div>
												</td>
												<td class="px-4 py-3">
													<div class="font-medium text-webropol-gray-900" x-text="r.firstName + ' ' + (r.lastName || '')"></div>
													<div class="text-xs text-webropol-gray-500" x-text="r.title || 'No title'"></div>
												</td>
												<td class="px-4 py-3">
													<span class="text-webropol-gray-700" x-text="r.department || '-'"></span>
												</td>
												<td class="px-4 py-3">
													<span class="text-webropol-gray-700" x-text="r.role || '-'"></span>
												</td>
												<td class="px-4 py-3 text-center">
													<span class="font-semibold" 
														  :class="r.sent > 0 ? 'text-webropol-primary-600' : 'text-webropol-gray-400'" 
														  x-text="r.sent"></span>
												</td>
												<td class="px-4 py-3 text-center">
													<span class="font-semibold" 
														  :class="r.responses > 0 ? 'text-emerald-600' : 'text-webropol-gray-400'" 
														  x-text="r.responses"></span>
												</td>
												<td class="px-4 py-3 text-center">
													<span class="status-indicator" 
														  :class="getStatusClass(r)">
														<i class="fa-regular fa-circle text-xs" :class="getStatusIcon(r)"></i>
														<span x-text="getStatusText(r)"></span>
													</span>
												</td>
												<td class="px-4 py-3">
													<div class="flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
														<button class="p-1.5 text-webropol-gray-500 hover:text-webropol-primary-600 hover:bg-webropol-primary-50 rounded-lg transition-colors" 
																title="Edit recipient" 
																@click="editRecipient(r)">
															<i class="fa-regular fa-pen text-xs"></i>
														</button>
														<button class="p-1.5 text-webropol-gray-500 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors" 
																title="View details" 
																@click="viewRecipientDetails(r)">
															<i class="fa-regular fa-eye text-xs"></i>
														</button>
														<button class="p-1.5 text-webropol-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors" 
																title="Remove recipient" 
																@click="removeRecipient(r)">
															<i class="fa-regular fa-trash text-xs"></i>
														</button>
													</div>
												</td>
											</tr>
										</template>
									</tbody>
								</table>
								
								<!-- Empty State -->
								<div x-show="pagedRecipients().length === 0" class="text-center py-12">
									<div class="w-16 h-16 bg-webropol-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
										<i class="fa-regular fa-users text-2xl text-webropol-gray-400"></i>
									</div>
									<h3 class="text-lg font-medium text-webropol-gray-900 mb-2">No recipients found</h3>
									<p class="text-webropol-gray-500 mb-6">Try adjusting your search criteria or add new recipients to get started.</p>
									<webropol-button variant="primary" @click="addRecipientSample()">
										<i class="fa-regular fa-user-plus mr-2"></i>Add First Recipient
									</webropol-button>
								</div>
							</div>

							<!-- Mobile Card View -->
							<div class="mobile-show-cards space-y-3 p-4">
								<template x-for="(r, idx) in pagedRecipients()" :key="r.id">
									<div class="mobile-card">
										<div class="flex items-start justify-between mb-3">
											<div class="flex items-center gap-3">
												<input type="checkbox" class="rounded border-2 text-webropol-primary-600" x-model="r.selected" />
												<div class="w-10 h-10 bg-webropol-primary-100 rounded-full flex items-center justify-center">
													<span class="text-sm font-semibold text-webropol-primary-700" 
														  x-text="r.firstName.charAt(0).toUpperCase()"></span>
												</div>
												<div>
													<div class="font-medium text-webropol-gray-900" x-text="r.firstName"></div>
													<div class="text-sm text-webropol-gray-600" x-text="r.email"></div>
												</div>
											</div>
											<span class="status-indicator text-xs" :class="getStatusClass(r)" x-text="getStatusText(r)"></span>
										</div>
										<div class="grid grid-cols-2 gap-4 text-sm">
											<div>
												<span class="text-webropol-gray-500">Sent:</span>
												<span class="font-medium ml-1" x-text="r.sent"></span>
											</div>
											<div>
												<span class="text-webropol-gray-500">Responses:</span>
												<span class="font-medium ml-1" x-text="r.responses"></span>
											</div>
										</div>
									</div>
								</template>
							</div>
						</div>

						<!-- Enhanced Pagination -->
						<div class="px-6 py-4 border-t border-webropol-gray-200 bg-webropol-gray-50">
							<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
								<div class="flex items-center gap-4 text-sm text-webropol-gray-600">
									<span>
										Showing <strong x-text="((page-1) * pageSize + 1)"></strong> to 
										<strong x-text="Math.min(page * pageSize, filtered().length)"></strong> of 
										<strong x-text="filtered().length"></strong> recipients
									</span>
									<span x-show="selectedCount() > 0" class="text-webropol-primary-600 font-medium">
										(<span x-text="selectedCount()"></span> selected)
									</span>
								</div>
								<div class="flex items-center gap-2">
									<webropol-button variant="ghost" size="sm" :disabled="page === 1" @click="page = 1">
										<i class="fa-regular fa-angles-left"></i>
									</webropol-button>
									<webropol-button variant="ghost" size="sm" :disabled="page === 1" @click="page--">
										<i class="fa-regular fa-angle-left"></i>
									</webropol-button>
									
									<!-- Page numbers -->
									<template x-for="pageNum in visiblePages()" :key="pageNum">
										<webropol-button :variant="pageNum === page ? 'primary' : 'ghost'" 
														 size="sm" 
														 @click="page = pageNum"
														 x-text="pageNum">
										</webropol-button>
									</template>
									
									<webropol-button variant="ghost" size="sm" :disabled="page >= totalPages()" @click="page++">
										<i class="fa-regular fa-angle-right"></i>
									</webropol-button>
									<webropol-button variant="ghost" size="sm" :disabled="page >= totalPages()" @click="page = totalPages()">
										<i class="fa-regular fa-angles-right"></i>
									</webropol-button>
								</div>
							</div>
						</div>
					</section>

					<!-- Email Campaign Management -->
					<section class="bg-white border border-webropol-gray-200 rounded-xl shadow-sm">
						<div class="px-6 py-4 border-b border-webropol-gray-200">
							<div class="flex items-center justify-between">
								<h2 class="text-lg font-semibold text-webropol-gray-800">Campaign Configuration</h2>
								<div class="flex items-center gap-3">
									<webropol-button variant="ghost" size="sm" @click="quickFillCampaign()">
										<i class="fa-regular fa-wand-magic-sparkles mr-1"></i>Quick Fill
									</webropol-button>
									<webropol-button variant="ghost" size="sm" @click="previewCampaign()">
										<i class="fa-regular fa-eye mr-1"></i>Preview
									</webropol-button>
								</div>
							</div>
							
							<!-- Delivery Method Selection -->
							<div class="flex items-center mt-4">
								<button class="px-4 py-2 font-medium transition-all duration-200 border-b-2 text-sm rounded-t-lg" 
										:class="tab==='now' ? 'border-webropol-primary-600 text-webropol-primary-700 bg-webropol-primary-50' : 'border-transparent text-webropol-gray-500 hover:text-webropol-gray-700 hover:bg-webropol-gray-50'" 
										@click="tab='now'">
									<i class="fa-regular fa-paper-plane mr-2"></i>Send Now
								</button>
								<button class="px-4 py-2 font-medium transition-all duration-200 border-b-2 text-sm rounded-t-lg" 
										:class="tab==='schedule' ? 'border-webropol-primary-600 text-webropol-primary-700 bg-webropol-primary-50' : 'border-transparent text-webropol-gray-500 hover:text-webropol-gray-700 hover:bg-webropol-gray-50'" 
										@click="tab='schedule'">
									<i class="fa-regular fa-calendar-clock mr-2"></i>Schedule
									<webropol-badge variant="info" size="sm" class="ml-2">0 Pending</webropol-badge>
								</button>
								<button class="px-4 py-2 font-medium transition-all duration-200 border-b-2 text-sm rounded-t-lg" 
										:class="tab==='ab' ? 'border-webropol-primary-600 text-webropol-primary-700 bg-webropol-primary-50' : 'border-transparent text-webropol-gray-500 hover:text-webropol-gray-700 hover:bg-webropol-gray-50'" 
										@click="tab='ab'">
									<i class="fa-regular fa-flask mr-2"></i>A/B Test
									<webropol-badge variant="warning" size="sm" class="ml-2">Beta</webropol-badge>
								</button>
							</div>
						</div>

						<div class="p-6 space-y-6">
							<!-- Essential Campaign Settings -->
							<div class="space-y-4">
								<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
									<!-- Email Template & Subject -->
									<div class="space-y-4">
										<div>
											<label class="block text-sm font-medium text-webropol-gray-700 mb-2">
												Email Template <span class="text-red-500">*</span>
											</label>
											<select class="enterprise-input w-full px-4 py-3 rounded-lg" x-model="form.template">
												<option value="">Select a template...</option>
												<option value="corporate">Corporate Standard</option>
												<option value="nps">NPS Survey</option>
												<option value="feedback">Feedback Request</option>
												<option value="reminder">Follow-up Reminder</option>
												<option value="custom">Custom Template</option>
											</select>
											<div class="mt-2 flex items-center gap-2">
												<webropol-button variant="ghost" size="sm" @click="previewTemplate()">
													<i class="fa-regular fa-eye mr-1"></i>Preview
												</webropol-button>
												<webropol-button variant="ghost" size="sm" @click="editTemplate()">
													<i class="fa-regular fa-pen mr-1"></i>Customize
												</webropol-button>
											</div>
										</div>

										<div>
											<label class="block text-sm font-medium text-webropol-gray-700 mb-2">
												Subject Line <span class="text-red-500">*</span>
											</label>
											<input type="text" 
												   class="enterprise-input w-full px-4 py-3 rounded-lg" 
												   placeholder="Your feedback is important to us" 
												   x-model="form.subject" 
												   maxlength="150"
												   required />
											<div class="flex items-center justify-between mt-2">
												<p class="text-xs text-webropol-gray-500">
													<span :class="form.subject.length > 50 ? 'text-amber-600' : ''">
														<span x-text="form.subject.length"></span>/150 characters
													</span>
													<span x-show="form.subject.length > 50" class="text-amber-600">
														(Long subjects may be truncated)
													</span>
												</p>
												<webropol-button variant="ghost" size="sm" @click="generateSubjectAI()">
													<i class="fa-regular fa-wand-magic-sparkles mr-1"></i>AI Suggest
												</webropol-button>
											</div>
										</div>
									</div>

									<!-- Sender Information -->
									<div class="space-y-4">
										<div>
											<label class="block text-sm font-medium text-webropol-gray-700 mb-2">
												From Address <span class="text-red-500">*</span>
											</label>
											<select class="enterprise-input w-full px-4 py-3 rounded-lg" x-model="form.fromType" @change="updateFromAddress()">
												<option value="noreply">No-Reply (Recommended)</option>
												<option value="custom">Custom Address</option>
												<option value="user">Your Email Address</option>
											</select>
											<input x-show="form.fromType === 'custom'" 
												   type="email" 
												   class="enterprise-input w-full px-4 py-3 rounded-lg mt-2" 
												   placeholder="Enter custom email address" 
												   x-model="form.customFromEmail" 
												   required />
											<p class="text-xs text-webropol-gray-500 mt-2">
												<i class="fa-regular fa-info-circle mr-1"></i>
												No-reply addresses improve deliverability
											</p>
										</div>
										
										<div>
											<label class="block text-sm font-medium text-webropol-gray-700 mb-2">
												Sender Name
											</label>
											<input type="text" 
												   class="enterprise-input w-full px-4 py-3 rounded-lg" 
												   placeholder="e.g., Survey Team, Customer Success" 
												   x-model="form.senderName" />
										</div>
									</div>
								</div>
							</div>

							<!-- Advanced Settings (Collapsible) -->
							<div class="border-t border-webropol-gray-200 pt-6" x-data="{ advancedOpen: false }">
								<button @click="advancedOpen = !advancedOpen" 
										class="w-full flex items-center justify-between p-4 text-left bg-webropol-gray-50 hover:bg-webropol-gray-100 rounded-lg transition-colors">
									<div class="flex items-center">
										<i class="fa-regular fa-gear mr-2 text-webropol-primary-600"></i>
										<span class="font-medium text-webropol-gray-800">Advanced Settings</span>
										<span class="text-sm text-webropol-gray-500 ml-2">(Reply-to, Priority, Delivery options)</span>
									</div>
									<i class="fa-regular fa-chevron-down text-webropol-gray-400 transition-transform" 
									   :class="advancedOpen ? 'rotate-180' : ''"></i>
								</button>

								<div x-show="advancedOpen" x-transition class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
									<div class="space-y-4">
										<div>
											<label class="block text-sm font-medium text-webropol-gray-700 mb-2">
												Reply-To Address
											</label>
											<input type="email" 
												   class="enterprise-input w-full px-4 py-3 rounded-lg" 
												   placeholder="support@yourcompany.com" 
												   x-model="form.replyTo" />
											<p class="text-xs text-webropol-gray-500 mt-2">
												Where replies will be sent (leave blank to disable)
											</p>
										</div>

										<div>
											<label class="block text-sm font-medium text-webropol-gray-700 mb-2">
												Priority Level
											</label>
											<select class="enterprise-input w-full px-4 py-3 rounded-lg" x-model="form.priority">
												<option value="normal">Normal Priority</option>
												<option value="high">High Priority</option>
												<option value="urgent">Urgent</option>
											</select>
											<p class="text-xs text-webropol-gray-500 mt-2">
												High priority may be filtered by email clients
											</p>
										</div>
									</div>

									<div class="space-y-4">
										<h4 class="text-sm font-semibold text-webropol-gray-700 flex items-center">
											<i class="fa-regular fa-clock mr-2"></i>Delivery Options
										</h4>
										
										<div>
											<label class="block text-sm font-medium text-webropol-gray-700 mb-2">
												Send Rate Limit
											</label>
											<select class="enterprise-input w-full px-4 py-3 rounded-lg" x-model="form.rateLimit">
												<option value="normal">Normal (100/hour)</option>
												<option value="fast">Fast (500/hour)</option>
												<option value="slow">Slow (50/hour)</option>
											</select>
										</div>

										<div>
											<label class="flex items-center">
												<input type="checkbox" class="rounded border-2 text-webropol-primary-600 mr-3" x-model="form.trackOpens" />
												<span class="text-sm font-medium text-webropol-gray-700">Track email opens</span>
											</label>
										</div>

										<div>
											<label class="flex items-center">
												<input type="checkbox" class="rounded border-2 text-webropol-primary-600 mr-3" x-model="form.trackClicks" />
												<span class="text-sm font-medium text-webropol-gray-700">Track link clicks</span>
											</label>
										</div>
									</div>
								</div>
							</div>

							<!-- Message Content Editor -->
							<div class="border-t border-webropol-gray-200 pt-6">
								<div class="flex items-center justify-between mb-6">
									<h3 class="text-base font-semibold text-webropol-gray-800 flex items-center">
										<i class="fa-regular fa-envelope-open mr-2 text-webropol-primary-600"></i>
										Message Content
									</h3>
									<div class="flex items-center gap-2">
										<webropol-badge variant="info" size="sm">AI Powered</webropol-badge>
										<webropol-button variant="ghost" size="sm" @click="insertMergeFields()">
											<i class="fa-regular fa-code mr-1"></i>Merge Fields
										</webropol-button>
									</div>
								</div>

								<div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
									<!-- Message Editor -->
									<div class="xl:col-span-2 space-y-6">
										
										<div class="space-y-4">
											<!-- AI-Powered Content Tools -->
											<div class="bg-gradient-to-r from-webropol-primary-50 to-blue-50 border border-webropol-primary-200 rounded-lg p-4">
												<div class="flex items-center justify-between mb-3">
													<h4 class="font-medium text-webropol-gray-800 flex items-center">
														<i class="fa-regular fa-wand-magic-sparkles mr-2 text-webropol-primary-600"></i>
														AI Content Assistant
													</h4>
													<webropol-badge variant="primary" size="sm">Beta</webropol-badge>
												</div>
												<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
													<webropol-button variant="secondary" size="sm" @click="generateAI()" class="w-full">
														<i class="fa-regular fa-robot mr-2"></i>Generate Content
													</webropol-button>
													<webropol-button variant="secondary" size="sm" @click="improveContent()" class="w-full">
														<i class="fa-regular fa-sparkles mr-2"></i>Improve Existing
													</webropol-button>
												</div>
											</div>

											<!-- Content Tools -->
											<div class="flex flex-wrap gap-2">
												<webropol-button variant="ghost" size="sm" @click="insertSurveyLink()">
													<i class="fa-regular fa-square-poll-horizontal mr-2"></i>Survey Link
												</webropol-button>
												<webropol-button variant="ghost" size="sm" @click="insertPersonalization()">
													<i class="fa-regular fa-user mr-2"></i>Personalization
												</webropol-button>
												<webropol-button variant="ghost" size="sm" @click="insertUnsubscribe()">
													<i class="fa-regular fa-link-slash mr-2"></i>Unsubscribe
												</webropol-button>
												<webropol-button variant="ghost" size="sm" @click="openSnippets()">
													<i class="fa-regular fa-file-text mr-2"></i>Snippets
												</webropol-button>
											</div>

											<!-- Enhanced Editor -->
											<div class="border border-webropol-gray-200 rounded-lg overflow-hidden bg-white">
												<div class="wysiwyg-toolbar flex items-center justify-between p-3 border-b bg-webropol-gray-50">
													<div class="flex items-center gap-1">
														<button class="px-2 py-1.5 rounded hover:bg-white transition-colors" 
																:aria-pressed="toolbar.bold" 
																@click="toolbar.bold = !toolbar.bold"
																title="Bold">
															<i class="fa-solid fa-bold"></i>
														</button>
														<button class="px-2 py-1.5 rounded hover:bg-white transition-colors" 
																:aria-pressed="toolbar.italic" 
																@click="toolbar.italic = !toolbar.italic"
																title="Italic">
															<i class="fa-solid fa-italic"></i>
														</button>
														<button class="px-2 py-1.5 rounded hover:bg-white transition-colors" 
																:aria-pressed="toolbar.ul" 
																@click="toolbar.ul = !toolbar.ul"
																title="Bullet List">
															<i class="fa-regular fa-list-ul"></i>
														</button>
														<div class="w-px h-6 bg-webropol-gray-300 mx-2"></div>
														<button class="px-2 py-1.5 rounded hover:bg-white transition-colors" title="Add Link">
															<i class="fa-regular fa-link"></i>
														</button>
														<button class="px-2 py-1.5 rounded hover:bg-white transition-colors" title="Insert Image">
															<i class="fa-regular fa-image"></i>
														</button>
													</div>
													<div class="flex items-center gap-2 text-xs text-webropol-gray-500">
														<span>Word count: <span class="font-medium" x-text="form.body.split(' ').length"></span></span>
													</div>
												</div>
												<div class="p-6">
													<textarea class="w-full h-48 border-0 resize-none focus:outline-none text-sm leading-relaxed" 
															  placeholder="Enter your email message here..." 
															  x-model="form.body"
															  aria-label="Email message content"></textarea>
												</div>
											</div>

											<!-- Live Preview -->
											<div>
												<div class="flex items-center justify-between mb-3">
													<h4 class="font-medium text-webropol-gray-800">Live Preview</h4>
													<div class="flex items-center gap-2">
														<webropol-button variant="ghost" size="sm" @click="togglePreviewMode()">
															<i class="fa-regular fa-mobile mr-1"></i>Mobile
														</webropol-button>
														<webropol-button variant="ghost" size="sm" @click="sendTestEmail()">
															<i class="fa-regular fa-paper-plane mr-1"></i>Send Test
														</webropol-button>
													</div>
												</div>
												<div class="border rounded-lg overflow-hidden bg-white shadow-sm">
													<div class="bg-webropol-primary-700 text-white px-6 py-4">
														<div class="flex items-center justify-between">
															<h5 class="font-semibold" x-text="form.subject"></h5>
															<span class="text-xs opacity-75">From: <span x-text="form.senderName || 'Survey Team'"></span></span>
														</div>
													</div>
													<div class="p-6 space-y-4 text-sm text-webropol-gray-800">
														<p>Hello <span class="font-semibold text-webropol-primary-700">[Recipient Name]</span>,</p>
														<div x-html="form.body.replace(/\n/g, '<br>')"></div>
														<div class="pt-4 border-t border-webropol-gray-200">
															<p class="text-webropol-gray-600">Best regards,<br/><span x-text="form.senderName || 'Survey Team'"></span></p>
														</div>
														<div class="pt-2">
															<webropol-button variant="primary" size="sm">Take Survey</webropol-button>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>

								<!-- Campaign Summary & Settings -->
								<div class="space-y-6">
									<!-- Attachments -->
									<div class="action-panel rounded-lg p-4">
										<h4 class="font-medium text-webropol-gray-800 mb-3 flex items-center">
											<i class="fa-regular fa-paperclip mr-2"></i>Attachments
										</h4>
										<div class="space-y-3">
											<div class="border-2 border-dashed border-webropol-gray-300 rounded-lg p-4 text-center">
												<input type="file" 
													   id="file-upload"
													   class="hidden" 
													   multiple 
													   accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg"
													   @change="handleFile($event)" />
												<label for="file-upload" 
													   class="cursor-pointer flex flex-col items-center gap-2">
													<i class="fa-regular fa-upload text-2xl text-webropol-gray-400"></i>
													<span class="text-sm text-webropol-gray-600">Drop files or click to upload</span>
													<span class="text-xs text-webropol-gray-500">Max 40MB per file</span>
												</label>
											</div>
											<p class="text-xs text-webropol-gray-500">
												Supported formats: PDF, DOC, XLS, Images
											</p>
										</div>
									</div>

									<!-- Compliance Options -->
									<div class="action-panel rounded-lg p-4">
										<h4 class="font-medium text-webropol-gray-800 mb-3 flex items-center">
											<i class="fa-regular fa-shield-check mr-2"></i>Compliance & Options
										</h4>
										<div class="space-y-3">
											<label class="flex items-start gap-3 text-sm">
												<input type="checkbox" 
													   class="mt-1 rounded border-2 text-webropol-primary-600" 
													   x-model="options.includeSurveyLink" />
												<span class="text-webropol-gray-700">
													Include survey link
													<span class="block text-xs text-webropol-gray-500 mt-1">
														Automatically appends survey link if not manually included
													</span>
												</span>
											</label>
											<label class="flex items-start gap-3 text-sm">
												<input type="checkbox" 
													   class="mt-1 rounded border-2 text-webropol-primary-600" 
													   x-model="options.includeUnsub" />
												<span class="text-webropol-gray-700">
													Include unsubscribe link
													<span class="block text-xs text-webropol-gray-500 mt-1">
														Required by law in many jurisdictions
													</span>
												</span>
											</label>
											<label class="flex items-start gap-3 text-sm">
												<input type="checkbox" 
													   class="mt-1 rounded border-2 text-webropol-primary-600" 
													   x-model="options.includePrivacy" />
												<span class="text-webropol-gray-700">
													Include privacy policy link
													<span class="block text-xs text-webropol-gray-500 mt-1">
														GDPR compliance recommendation
													</span>
												</span>
											</label>
											<label class="flex items-start gap-3 text-sm">
												<input type="checkbox" 
													   class="mt-1 rounded border-2 text-webropol-primary-600" 
													   x-model="options.trackOpens" />
												<span class="text-webropol-gray-700">
													Track email opens
													<span class="block text-xs text-webropol-gray-500 mt-1">
														Provides engagement analytics
													</span>
												</span>
											</label>
										</div>
									</div>

									<!-- Campaign Summary -->
									<div class="action-panel rounded-lg p-4">
										<h4 class="font-semibold text-webropol-gray-800 mb-4 flex items-center">
											<i class="fa-regular fa-chart-bar mr-2"></i>Campaign Summary
										</h4>
										<div class="space-y-3">
											<dl class="text-sm space-y-2">
												<div class="flex justify-between items-center">
													<dt class="text-webropol-gray-600">Recipients:</dt>
													<dd class="font-medium">
														<webropol-badge :variant="selectedCount() > 0 ? 'success' : 'warning'" x-text="selectedCount() + ' selected'"></webropol-badge>
													</dd>
												</div>
												<div class="flex justify-between items-center">
													<dt class="text-webropol-gray-600">From:</dt>
													<dd class="text-right font-medium text-xs" x-text="form.senderName || 'Survey Team'"></dd>
												</div>
												<div class="flex justify-between items-center">
													<dt class="text-webropol-gray-600">Template:</dt>
													<dd class="text-right font-medium text-xs uppercase" x-text="form.template"></dd>
												</div>
												<div class="flex justify-between items-start">
													<dt class="text-webropol-gray-600">Subject:</dt>
													<dd class="text-right font-medium text-xs max-w-32" x-text="form.subject"></dd>
												</div>
												<div class="flex justify-between items-center">
													<dt class="text-webropol-gray-600">Priority:</dt>
													<dd class="text-right">
														<webropol-badge :variant="form.priority === 'urgent' ? 'danger' : form.priority === 'high' ? 'warning' : 'info'" 
																		 size="sm" 
																		 x-text="form.priority"></webropol-badge>
													</dd>
												</div>
											</dl>
											
											<div class="pt-4 border-t border-webropol-gray-200">
												<div class="space-y-2">
													<webropol-button variant="secondary" class="w-full" @click="previewCampaign()">
														<i class="fa-regular fa-eye mr-2"></i>Preview Campaign
													</webropol-button>
													<webropol-button variant="primary" 
																	 class="w-full" 
																	 :disabled="selectedCount() === 0 || !form.subject" 
																	 @click="send()">
														<i class="fa-regular fa-paper-plane mr-2"></i>
														<span x-text="tab === 'schedule' ? 'Schedule Campaign' : 'Send Campaign'"></span>
													</webropol-button>
												</div>
												<p x-show="selectedCount() === 0" class="text-xs text-amber-600 mt-2 text-center">
													Select recipients to enable sending
												</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</section>

				</div>
			</main>
		</div>
	</div>

	<script>
		function privateLinksPage() {
			return {
				recipients: [],
				selectAll: false,
				page: 1,
				pageSize: 25,
				searchField: 'firstName',
				searchOp: 'contains',
				searchText: '',
				statusFilter: '',
				sortField: 'firstName',
				sortDirection: 'asc',
				tab: 'now',
				form: {
					fromType: 'noreply',
					customFromEmail: '',
					senderName: 'Survey Team',
					replyTo: '',
					template: 'corporate',
					subject: 'Your feedback helps us improve – Quick survey inside',
					priority: 'normal',
					body: 'We would appreciate your feedback. Please take a moment to complete our short survey.'
				},
				toolbar: { bold: true, italic: false, ul: false },
				options: { includeSurveyLink: true, includeUnsub: true, includeUnsubOrg: false, includeRespondentUnsub: false },

				init() {
					// Seed enhanced demo recipients with enterprise data
					this.recipients = [
						{ 
							id: 1, 
							email: 'all@webropol.com', 
							firstName: 'All', 
							lastName: 'Staff',
							title: 'Distribution List',
							department: 'Company-wide', 
							role: 'All Employees',
							sent: 12, 
							responses: 8, 
							updated: 2,
							lastUpdated: new Date().toISOString(),
							valid: true, 
							status: 'responded',
							selected: false 
						},
						{ 
							id: 2, 
							email: 'henrik.romar@webropol.com', 
							firstName: 'Henrik', 
							lastName: 'Romar',
							title: 'Senior Developer',
							department: 'Engineering', 
							role: 'Technical Lead',
							sent: 3, 
							responses: 2, 
							updated: 1,
							lastUpdated: new Date(Date.now() - 86400000).toISOString(),
							valid: true, 
							status: 'responded',
							selected: false 
						},
						{ 
							id: 3, 
							email: 'marko.poopchev@webropol.com', 
							firstName: 'Marko', 
							lastName: 'Poopchev',
							title: 'Product Manager',
							department: 'Product', 
							role: 'Manager',
							sent: 2, 
							responses: 0, 
							updated: 0,
							lastUpdated: new Date(Date.now() - 172800000).toISOString(),
							valid: true, 
							status: 'sent',
							selected: false 
						},
						{ 
							id: 4, 
							email: 'sarah.wilson@webropol.com', 
							firstName: 'Sarah', 
							lastName: 'Wilson',
							title: 'UX Designer',
							department: 'Design', 
							role: 'Senior Designer',
							sent: 1, 
							responses: 1, 
							updated: 0,
							lastUpdated: new Date(Date.now() - 259200000).toISOString(),
							valid: true, 
							status: 'responded',
							selected: false 
						}
					];
				},

				// Enhanced filtering and sorting
				filtered() {
					let results = [...this.recipients];
					
					// Text search
					if (this.searchText.trim()) {
						const searchTerm = this.searchText.trim().toLowerCase();
						results = results.filter(r => {
							let searchValue = '';
							switch (this.searchField) {
								case 'email': searchValue = r.email.toLowerCase(); break;
								case 'firstName': searchValue = (r.firstName + ' ' + (r.lastName || '')).toLowerCase(); break;
								case 'department': searchValue = (r.department || '').toLowerCase(); break;
								case 'role': searchValue = (r.role || '').toLowerCase(); break;
								default: searchValue = r.firstName.toLowerCase();
							}
							
							switch (this.searchOp) {
								case 'starts': return searchValue.startsWith(searchTerm);
								case 'exact': return searchValue === searchTerm;
								default: return searchValue.includes(searchTerm);
							}
						});
					}
					
					// Status filter
					if (this.statusFilter) {
						results = results.filter(r => {
							switch (this.statusFilter) {
								case 'valid': return r.valid;
								case 'invalid': return !r.valid;
								case 'unsent': return r.sent === 0;
								case 'sent': return r.sent > 0;
								case 'responded': return r.responses > 0;
								default: return true;
							}
						});
					}
					
					// Sorting
					results.sort((a, b) => {
						let aVal = a[this.sortField] || '';
						let bVal = b[this.sortField] || '';
						
						if (typeof aVal === 'string') {
							aVal = aVal.toLowerCase();
							bVal = bVal.toLowerCase();
						}
						
						const comparison = aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
						return this.sortDirection === 'asc' ? comparison : -comparison;
					});
					
					return results;
				},

				totalPages() { return Math.max(1, Math.ceil(this.filtered().length / this.pageSize)); },
				
				pagedRecipients() {
					const start = (this.page - 1) * this.pageSize;
					return this.filtered().slice(start, start + this.pageSize);
				},
				
				selectedCount() { return this.recipients.filter(r => r.selected).length; },
				
				visiblePages() {
					const total = this.totalPages();
					const current = this.page;
					const delta = 2;
					const range = [];
					
					for (let i = Math.max(2, current - delta); i <= Math.min(total - 1, current + delta); i++) {
						range.push(i);
					}
					
					if (current - delta > 2) range.unshift(1, '...');
					else if (total > 1) range.unshift(1);
					
					if (current + delta < total - 1) range.push('...', total);
					else if (total > 1 && range[range.length - 1] !== total) range.push(total);
					
					return range.filter(p => p !== '...' || true);
				},
				
				// Enhanced actions
				toggleSelectAll() { 
					this.pagedRecipients().forEach(r => r.selected = this.selectAll); 
				},
				
				clearSelection() {
					this.recipients.forEach(r => r.selected = false);
					this.selectAll = false;
				},
				
				clearAllFilters() {
					this.searchText = '';
					this.statusFilter = '';
					this.page = 1;
				},
				
				performSearch() {
					this.page = 1; // Reset to first page when searching
				},
				
				sortBy(field) {
					if (this.sortField === field) {
						this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
					} else {
						this.sortField = field;
						this.sortDirection = 'asc';
					}
				},
				
				// Status and formatting helpers
				getStatusClass(recipient) {
					if (!recipient.valid) return 'status-error';
					if (recipient.responses > 0) return 'status-success';
					if (recipient.sent > 0) return 'status-warning';
					return 'status-info';
				},
				
				getStatusIcon(recipient) {
					if (!recipient.valid) return 'fa-circle-xmark';
					if (recipient.responses > 0) return 'fa-circle-check';
					if (recipient.sent > 0) return 'fa-clock';
					return 'fa-circle';
				},
				
				getStatusText(recipient) {
					if (!recipient.valid) return 'Invalid';
					if (recipient.responses > 0) return 'Responded';
					if (recipient.sent > 0) return 'Sent';
					return 'Ready';
				},
				
				formatDate(dateString) {
					return new Date(dateString).toLocaleDateString();
				},
				
				// Enterprise actions
				exportRecipients() {
					alert('Export functionality - would generate CSV/Excel with all recipient data');
				},
				
				showAuditLog() {
					alert('Activity log - would show all campaign activities and changes');
				},
				
				showQuickSend() {
					alert('Quick send modal - streamlined sending interface');
				},
				
				showBulkImport() {
					alert('Bulk import modal - CSV/Excel upload with validation');
				},
				
				sendToSelected() {
					const selected = this.selectedCount();
					if (selected === 0) {
						alert('Please select recipients first');
						return;
					}
					alert(`Sending campaign to ${selected} selected recipients`);
				},
				
				exportSelected() {
					const selected = this.selectedCount();
					if (selected === 0) {
						alert('Please select recipients first');
						return;
					}
					alert(`Exporting ${selected} selected recipients`);
				},
				
				removeSelected() {
					const selected = this.selectedCount();
					if (selected === 0) {
						alert('Please select recipients first');
						return;
					}
					if (confirm(`Remove ${selected} selected recipients? This cannot be undone.`)) {
						this.recipients = this.recipients.filter(r => !r.selected);
						this.clearSelection();
					}
				},
				
				// Individual recipient actions
				addRecipientSample() {
					const id = this.recipients.length + 1;
					this.recipients.push({ 
						id, 
						email: `user${id}@example.com`, 
						firstName: `User${id}`,
						lastName: 'Sample',
						title: 'Sample User',
						department: 'Testing', 
						role: 'User',
						sent: 0, 
						responses: 0, 
						updated: 0,
						lastUpdated: new Date().toISOString(),
						valid: true, 
						status: 'ready',
						selected: false 
					});
				},
				
				editRecipient(r) { 
					alert('Edit recipient modal - would open detailed editing form for: ' + r.email); 
				},
				
				viewRecipientDetails(r) {
					alert('Recipient details - would show complete profile and history for: ' + r.email);
				},
				
				removeRecipient(r) {
					if (confirm(`Remove ${r.email}? This cannot be undone.`)) {
						const index = this.recipients.findIndex(rec => rec.id === r.id);
						if (index > -1) this.recipients.splice(index, 1);
					}
				},
				
				// Form actions
				updateFromAddress() {
					// Update form based on selected from type
				},
				
				previewTemplate() {
					alert('Template preview - would show how the email will look');
				},
				
				editTemplate() {
					alert('Template editor - would open advanced email template designer');
				},
				
				generateSubjectAI() {
					const suggestions = [
						'Your feedback matters - Quick 2-minute survey',
						'Help us serve you better - Share your thoughts',
						'We value your opinion - Brief survey inside',
						'Quick survey: How are we doing?'
					];
					this.form.subject = suggestions[Math.floor(Math.random() * suggestions.length)];
				},
				
				// Legacy compatibility
				toggleDemographics() { 
					alert('Demographics panel - would show advanced demographic filtering options'); 
				},
				
				handleFile(e) { 
					const f = e.target.files?.[0]; 
					if (f) alert('File attachment - would process: ' + f.name); 
				},
				
				generateAI() { 
					this.form.body = 'We value your feedback and would appreciate a few minutes of your time to help us improve our services. Your responses will remain confidential and help shape our future offerings.'; 
				},
				
				// Enhanced content and template functions
				improveContent() {
					alert('AI Content Improvement - would analyze and suggest improvements to existing content');
				},
				
				insertSurveyLink() {
					this.form.body += '\n\n[Take the survey here: [SurveyLink]]';
				},
				
				insertPersonalization() {
					alert('Personalization tokens - would show available merge fields like [FirstName], [Company], etc.');
				},
				
				insertUnsubscribe() {
					this.form.body += '\n\n[Unsubscribe: [UnsubscribeLink]]';
				},
				
				openSnippets() {
					alert('Content snippets library - would show pre-written content blocks');
				},
				
				togglePreviewMode() {
					alert('Mobile preview - would switch to mobile email preview mode');
				},
				
				sendTestEmail() {
					alert('Test email - would send preview to specified email address');
				},
				
				previewCampaign() {
					alert('Campaign preview - would show complete campaign preview with all settings');
				},
				
				send() { 
					const selected = this.selectedCount();
					if (selected === 0) {
						alert('Please select recipients before sending');
						return;
					}
					
					// Validation
					if (!this.form.subject.trim()) {
						alert('Please enter a subject line');
						return;
					}
					
					if (!this.form.body.trim()) {
						alert('Please enter message content');
						return;
					}
					
					// Show confirmation with details
					const confirmation = `
Campaign Ready for ${this.tab === 'schedule' ? 'Scheduling' : 'Delivery'}

Recipients: ${selected}
Subject: ${this.form.subject}
Priority: ${this.form.priority}
Template: ${this.form.template}

${this.tab === 'schedule' ? 'Schedule this campaign?' : 'Send this campaign now?'}
					`.trim();
					
					if (confirm(confirmation)) {
						alert(`✅ Campaign "${this.form.subject}" ${this.tab === 'schedule' ? 'scheduled successfully' : 'sent successfully'} to ${selected} recipients`);
					}
				}
			}
		}
	</script>
</body>
</html>
